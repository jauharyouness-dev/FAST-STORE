<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAST STORE âš¡</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#0A0A0F; font-family:'Segoe UI',Tahoma,sans-serif; direction:rtl; }
::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:#0A0A0F; }
::-webkit-scrollbar-thumb { background:#FF6B0040; border-radius:2px; }
input,button,textarea,select { font-family:'Segoe UI',Tahoma,sans-serif; }
input:focus,textarea:focus,select:focus { outline:none; }
@keyframes spin     { to{transform:rotate(360deg)} }
@keyframes fadeIn   { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
@keyframes fadeDown { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
@keyframes pulse    { 0%,100%{opacity:1} 50%{opacity:.5} }
@keyframes glow     { 0%,100%{box-shadow:0 0 20px #FF6B0040} 50%{box-shadow:0 0 50px #FF6B0080} }
@keyframes slideUp  { from{transform:translateY(100%)} to{transform:translateY(0)} }
@keyframes toastIn  { from{opacity:0;transform:translateX(-50%) translateY(-20px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
@keyframes float    { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-7px)} }
@keyframes shake    { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
@keyframes bgPulse  { 0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)} }
@keyframes notifPop { 0%{transform:scale(0)} 50%{transform:scale(1.2)} 100%{transform:scale(1)} }
@keyframes typing   { 0%,80%,100%{transform:scale(0)} 40%{transform:scale(1)} }
</style>
</head>
<body>
<div id="root"></div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBKutzG178Fnp_3LIN1dXl_IEyDub1JCVw",
  authDomain: "fast-store-79d55.firebaseapp.com",
  projectId: "fast-store-79d55",
  storageBucket: "fast-store-79d55.firebasestorage.app",
  messagingSenderId: "938372337651",
  appId: "1:938372337651:web:1b832a670fae1d8c510c86"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const TG_TOKEN = "8390349160:AAGlePL2KGPU4nmtR7XackUOsyQY50XqAC0";
const TG_CHAT_ID = "8038053852";
const ADMIN_EMAIL = "younesd.55yyy5@gmail.com";

// Ø¥Ø±Ø³Ø§Ù„ ÙÙ‚Ø· Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† (Ù„ÙŠØ³ Ø§Ù„Ø·Ù„Ø¨Ø§Øª)
async function sendTelegram(message) {
  try {
    await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ chat_id: TG_CHAT_ID, text: message, parse_mode: "Markdown" })
    });
  } catch(e) {}
}

// Ø¯Ø§Ù„Ø© AI Ù„Ù„Ø¯Ø¹Ù…
async function askAI(messages) {
  try {
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø¯Ø¹Ù… ÙÙ†ÙŠ Ù„Ù…ØªØ¬Ø± Ø±Ù‚Ù…ÙŠ Ø§Ø³Ù…Ù‡ "FAST STORE âš¡". Ø§Ù„Ù…ØªØ¬Ø± ÙŠØ¨ÙŠØ¹ Ø®Ø¯Ù…Ø§Øª Instagram Ùˆ TikTok ÙÙ‚Ø·.
Ø®Ø¯Ù…Ø§Øª Instagram: Ù…ØªØ§Ø¨Ø¹ÙŠÙ† (500 Ø¨Ù€5 DHØŒ 1000 Ø¨Ù€10 DHØŒ 2000 Ø¨Ù€20 DH)ØŒ ØªØ¹Ù„ÙŠÙ‚Ø§Øª (50 Ø¨Ù€5 DHØŒ 100 Ø¨Ù€10 DHØŒ 200 Ø¨Ù€15 DH)ØŒ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø³ØªÙˆØ±ÙŠ (50 Ø¨Ù€5 DHØŒ 100 Ø¨Ù€10 DHØŒ 200 Ø¨Ù€15 DH).
Ø®Ø¯Ù…Ø§Øª TikTok: Ø­Ø³Ø§Ø¨Ø§Øª (1K Ø¨Ù€10 DHØŒ 10K Ø¨Ù€50 DHØŒ 30K Ø¨Ù€100 DH) â€” Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙÙ‚Ø· Ø¹Ø¨Ø± Ø£Ø¯Ù…Ù† Ø§Ù„Ù‚Ø±ÙˆØ¨.
Ø§Ù„Ø´Ø­Ù† Ø¹Ø¨Ø± Orange Money. Ø£Ø¬Ø¨ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ÙˆØ¯ÙŠ ÙˆÙ…ÙˆØ¬Ø².`,
        messages: messages
      })
    });
    const data = await res.json();
    return data.content?.[0]?.text || "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.";
  } catch(e) {
    return "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø®Ø¯Ù…Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± WhatsApp.";
  }
}
</script>
<script type="text/babel">
const { useState, useEffect, useRef } = React;
const ORANGE="#FF6B00", ORANGE2="#FF9500", BLUE_FB="#1877F2";
const BG="#0A0A0F", CARD="#12121A", CARD2="#1A1A2E";
const GREEN="#22C55E", RED="#EF4444";
const WA_LINK = "https://chat.whatsapp.com/Eh43LkrbSpF7pWs6pPEfAn";
const IG_USER = "Fast.____.store";

const PLANS = [
  { dh:5, popular:false },
  { dh:10, popular:true },
  { dh:20, popular:false },
  { dh:50, popular:false },
];

const services = [
  { id:3, category:"Instagram", icon:"ğŸ“¸", items:[
    { id:31, name:"ğŸ“ˆ 500 Ù…ØªØ§Ø¨Ø¹", price:5, desc:"500 Ù…ØªØ§Ø¨Ø¹ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØ¢Ù…Ù†", rating:4.7, sold:445 },
    { id:32, name:"ğŸ“ˆ 1000 Ù…ØªØ§Ø¨Ø¹", price:10, desc:"1000 Ù…ØªØ§Ø¨Ø¹ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆØ¢Ù…Ù†", rating:4.8, sold:523 },
    { id:33, name:"ğŸ“ˆ 2000 Ù…ØªØ§Ø¨Ø¹", price:20, desc:"2000 Ù…ØªØ§Ø¨Ø¹ Ø¨Ø³Ø¹Ø± Ù…Ù…ØªØ§Ø²", rating:4.9, sold:312 },
    { id:34, name:"ğŸ’¬ 50 ØªØ¹Ù„ÙŠÙ‚", price:5, desc:"50 ØªØ¹Ù„ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ", rating:4.6, sold:234 },
    { id:35, name:"ğŸ’¬ 100 ØªØ¹Ù„ÙŠÙ‚", price:10, desc:"100 ØªØ¹Ù„ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ", rating:4.7, sold:189 },
    { id:36, name:"ğŸ’¬ 200 ØªØ¹Ù„ÙŠÙ‚", price:15, desc:"200 ØªØ¹Ù„ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ", rating:4.8, sold:145 },
    { id:37, name:"ğŸ‘€ 50 Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³ØªÙˆØ±ÙŠ", price:5, desc:"50 Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„Ø³ØªÙˆØ±ÙŠ", rating:4.9, sold:612 },
    { id:38, name:"ğŸ‘€ 100 Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³ØªÙˆØ±ÙŠ", price:10, desc:"100 Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„Ø³ØªÙˆØ±ÙŠ", rating:4.9, sold:534 },
    { id:39, name:"ğŸ‘€ 200 Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³ØªÙˆØ±ÙŠ", price:15, desc:"200 Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙˆØ±ÙŠØ© Ù„Ù„Ø³ØªÙˆØ±ÙŠ", rating:5.0, sold:421 },
  ]},
  { id:4, category:"TikTok", icon:"ğŸµ", items:[
    { id:41, name:"ğŸµ Ø­Ø³Ø§Ø¨ TikTok 1K", price:10, desc:"Ø­Ø³Ø§Ø¨ ØªÙŠÙƒ ØªÙˆÙƒ 1,000 Ù…ØªØ§Ø¨Ø¹", rating:4.7, sold:98 },
    { id:42, name:"ğŸµ Ø­Ø³Ø§Ø¨ TikTok 10K", price:50, desc:"Ø­Ø³Ø§Ø¨ ØªÙŠÙƒ ØªÙˆÙƒ 10,000 Ù…ØªØ§Ø¨Ø¹", rating:4.8, sold:67 },
    { id:43, name:"ğŸµ Ø­Ø³Ø§Ø¨ TikTok 30K", price:100, desc:"Ø­Ø³Ø§Ø¨ ØªÙŠÙƒ ØªÙˆÙƒ 30,000 Ù…ØªØ§Ø¨Ø¹", rating:4.9, sold:34 },
  ]},
];

function Counter({ value }) {
  const [d, setD] = useState(0);
  useEffect(() => {
    let c=0; const step=Math.max(1,Math.ceil(value/50));
    const t=setInterval(()=>{ c+=step; if(c>=value){setD(value);clearInterval(t);}else setD(c); },25);
    return()=>clearInterval(t);
  },[value]);
  return d.toLocaleString('ar');
}

function Stars({ rating }) {
  return <span style={{color:"#FFB800",fontSize:11}}>{"â˜…".repeat(Math.floor(rating))}{"â˜†".repeat(5-Math.floor(rating))}<span style={{color:"#ffffff50",marginRight:4}}>{rating}</span></span>;
}

function Splash({ onDone }) {
  const [prog, setProg] = useState(0);
  useEffect(()=>{ const t=setInterval(()=>setProg(p=>{ if(p>=100){clearInterval(t);setTimeout(onDone,300);return 100;} return p+2; }),30); return()=>clearInterval(t); },[]);
  return (
    <div style={{position:"fixed",inset:0,background:BG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999}}>
      {[...Array(4)].map((_,i)=><div key={i} style={{position:"absolute",width:130+i*100,height:130+i*100,borderRadius:"50%",border:`1px solid ${i%2===0?ORANGE:ORANGE2}12`,top:"50%",left:"50%",transform:"translate(-50%,-50%)",animation:`pulse ${2+i*0.4}s ease-in-out infinite`}}/>)}
      <div style={{width:110,height:110,borderRadius:"50%",background:`conic-gradient(${ORANGE},${ORANGE2},${ORANGE})`,display:"flex",alignItems:"center",justifyContent:"center",animation:"spin 3s linear infinite",boxShadow:`0 0 50px ${ORANGE}60`,marginBottom:32}}>
        <div style={{width:90,height:90,borderRadius:"50%",background:BG,display:"flex",alignItems:"center",justifyContent:"center",fontSize:42}}>âš¡</div>
      </div>
      <div style={{fontSize:36,fontWeight:900,letterSpacing:5,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",animation:"float 3s ease-in-out infinite"}}>FAST STORE</div>
      <div style={{color:"#ffffff50",fontSize:14,marginTop:8,letterSpacing:3}}>Ù…ØªØ¬Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© #1</div>
      <div style={{width:240,marginTop:44}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
          <span style={{color:"#ffffff40",fontSize:12}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
          <span style={{color:ORANGE,fontSize:12,fontWeight:700}}>{prog}%</span>
        </div>
        <div style={{height:5,background:"#ffffff10",borderRadius:10,overflow:"hidden"}}>
          <div style={{height:"100%",borderRadius:10,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,width:`${prog}%`,transition:"width 0.1s"}}/>
        </div>
      </div>
    </div>
  );
}

function LoginScreen({ onLogin, showToast }) {
  const [mode,setMode]=useState("login"); const [email,setEmail]=useState(""); const [pass,setPass]=useState(""); const [name,setName]=useState("");
  const [loading,setLoad]=useState(false); const [showP,setShowP]=useState(false); const [err,setErr]=useState(""); const [shake,setShake]=useState(false);
  const doShake=()=>{setShake(true);setTimeout(()=>setShake(false),500);};
  const errMsgs={"auth/email-already-in-use":"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„","auth/wrong-password":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©","auth/user-not-found":"Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯","auth/weak-password":"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)","auth/invalid-email":"ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø©","auth/invalid-credential":"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©","auth/too-many-requests":"Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹","auth/network-request-failed":"ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ","auth/popup-closed-by-user":"ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©"};
  const saveUser=async(uid,data)=>{try{await db.collection("users").doc(uid).set(data,{merge:true});}catch(e){}};

  const handleGoogle=async()=>{
    setLoad(true);setErr("");
    try{
      const p=new firebase.auth.GoogleAuthProvider(); const cred=await auth.signInWithPopup(p);
      const snap=await db.collection("users").doc(cred.user.uid).get();
      if(!snap.exists){await saveUser(cred.user.uid,{name:cred.user.displayName||"Ù…Ø³ØªØ®Ø¯Ù…",email:cred.user.email,balance:0,points:0,createdAt:firebase.firestore.FieldValue.serverTimestamp()});await sendTelegram(`ğŸ‘¤ *Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ (Google)!*\nğŸ™ ${cred.user.displayName}\nâœ‰ï¸ ${cred.user.email}`);}
      const data=snap.exists?snap.data():{balance:0,points:0};
      onLogin({uid:cred.user.uid,name:cred.user.displayName||"Ù…Ø³ØªØ®Ø¯Ù…",email:cred.user.email,balance:data.balance||0,points:data.points||0});
    }catch(e){setErr(errMsgs[e.code]||"ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google");doShake();}
    setLoad(false);
  };

  const handleFacebook=async()=>{
    setLoad(true);setErr("");
    try{
      const p=new firebase.auth.FacebookAuthProvider(); const cred=await auth.signInWithPopup(p);
      const snap=await db.collection("users").doc(cred.user.uid).get();
      if(!snap.exists)await saveUser(cred.user.uid,{name:cred.user.displayName||"Ù…Ø³ØªØ®Ø¯Ù…",email:cred.user.email||"",balance:0,points:0,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
      const data=snap.exists?snap.data():{balance:0,points:0};
      onLogin({uid:cred.user.uid,name:cred.user.displayName||"Ù…Ø³ØªØ®Ø¯Ù…",email:cred.user.email||"",balance:data.balance||0,points:data.points||0});
    }catch(e){setErr(errMsgs[e.code]||"ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Facebook");doShake();}
    setLoad(false);
  };

  const handleEmail=async()=>{
    setErr("");
    if(mode==="register"){if(!name.trim()){setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…");doShake();return;}if(!email.trim()){setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯");doShake();return;}if(!pass.trim()){setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");doShake();return;}if(pass.length<6){setErr("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");doShake();return;}}
    else{if(!email.trim()||!pass.trim()){setErr("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");doShake();return;}}
    setLoad(true);
    try{
      if(mode==="register"){
        const cred=await auth.createUserWithEmailAndPassword(email.trim(),pass);
        try{await cred.user.updateProfile({displayName:name.trim()});}catch(e){}
        await saveUser(cred.user.uid,{name:name.trim(),email:email.trim(),balance:0,points:100,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
        try{await sendTelegram(`ğŸ‘¤ *Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯!*\nğŸ™ ${name.trim()}\nâœ‰ï¸ ${email.trim()}`);}catch(e){}
        onLogin({uid:cred.user.uid,name:name.trim(),email:email.trim(),balance:0,points:100}); showToast("ğŸ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 100 Ù†Ù‚Ø·Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©!");
      }else{
        const cred=await auth.signInWithEmailAndPassword(email.trim(),pass);
        let data={name:cred.user.displayName||email.split("@")[0],balance:0,points:0};
        try{const s=await db.collection("users").doc(cred.user.uid).get();if(s.exists)data=s.data();}catch(e){}
        onLogin({uid:cred.user.uid,name:data.name,email:email.trim(),balance:data.balance||0,points:data.points||0});
      }
    }catch(e){setErr(errMsgs[e.code]||`Ø­Ø¯Ø« Ø®Ø·Ø£: ${e.message}`);doShake();}
    setLoad(false);
  };

  const handleForgot=async()=>{
    if(!email.trim()){setErr("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹");doShake();return;}
    setLoad(true);
    try{await auth.sendPasswordResetEmail(email.trim());showToast("ğŸ“§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©!");setMode("login");}
    catch(e){setErr(errMsgs[e.code]||"Ø­Ø¯Ø« Ø®Ø·Ø£");doShake();}
    setLoad(false);
  };

  return (
    <div style={{minHeight:"100vh",background:BG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 24px",position:"relative",overflow:"hidden"}}>
      <div style={{position:"absolute",top:-100,right:-80,width:280,height:280,borderRadius:"50%",background:`${ORANGE}08`,filter:"blur(60px)",animation:"bgPulse 8s ease-in-out infinite"}}/>
      <div style={{position:"absolute",bottom:-80,left:-60,width:220,height:220,borderRadius:"50%",background:`${ORANGE2}06`,filter:"blur(50px)",animation:"bgPulse 10s ease-in-out infinite reverse"}}/>
      <div style={{textAlign:"center",marginBottom:28,animation:"fadeDown 0.6s ease"}}>
        <div style={{width:80,height:80,borderRadius:24,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:36,margin:"0 auto 14px",boxShadow:`0 0 30px ${ORANGE}50`,animation:"glow 3s ease-in-out infinite"}}>âš¡</div>
        <div style={{fontSize:26,fontWeight:900,letterSpacing:4,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>FAST STORE</div>
        <div style={{color:"#ffffff40",fontSize:13,marginTop:6}}>{mode==="login"?"Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ğŸ‘‹":mode==="register"?"Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù† ğŸš€":"Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ”‘"}</div>
      </div>
      <div style={{width:"100%",maxWidth:400,background:CARD2,borderRadius:24,padding:24,border:"1px solid #ffffff0A",boxShadow:"0 20px 60px #00000060",animation:"fadeIn 0.5s ease"}}>
        {mode!=="forgot"&&(<>
          <div style={{display:"flex",gap:10,marginBottom:16}}>
            <button onClick={handleGoogle} style={{flex:1,background:"#ffffff",border:"none",borderRadius:14,padding:"13px",color:"#333",fontWeight:700,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,boxShadow:"0 2px 10px #00000030"}}>
              <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
              Google
            </button>
            <button onClick={handleFacebook} style={{flex:1,background:BLUE_FB,border:"none",borderRadius:14,padding:"13px",color:"#fff",fontWeight:700,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
              Facebook
            </button>
          </div>
          <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:16}}>
            <div style={{flex:1,height:1,background:"#ffffff12"}}/><span style={{color:"#ffffff30",fontSize:12}}>Ø£Ùˆ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span><div style={{flex:1,height:1,background:"#ffffff12"}}/>
          </div>
        </>)}
        {err&&<div style={{background:"#EF444415",border:"1px solid #EF444430",borderRadius:12,padding:"10px 14px",marginBottom:14,color:"#EF4444",fontSize:13,textAlign:"center",animation:"fadeIn 0.3s ease"}}>âŒ {err}</div>}
        {mode==="register"&&(
          <div style={{marginBottom:12}}>
            <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</div>
            <div style={{position:"relative"}}><span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>ğŸ‘¤</span>
              <input value={name} onChange={e=>setName(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" style={{width:"100%",background:"#ffffff08",border:`1px solid ${name?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px 13px 14px",color:"#fff",fontSize:14,boxSizing:"border-box"}}/>
            </div>
          </div>
        )}
        <div style={{marginBottom:12}}>
          <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
          <div style={{position:"relative"}}><span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>âœ‰ï¸</span>
            <input value={email} onChange={e=>{setEmail(e.target.value);setErr("");}} placeholder="example@email.com" type="email" style={{width:"100%",background:"#ffffff08",border:`1px solid ${email?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px 13px 14px",color:"#fff",fontSize:14,boxSizing:"border-box",animation:shake?"shake 0.4s ease":"none"}}/>
          </div>
        </div>
        {mode!=="forgot"&&(
          <div style={{marginBottom:16}}>
            <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
            <div style={{position:"relative"}}><span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>ğŸ”’</span>
              <input value={pass} onChange={e=>{setPass(e.target.value);setErr("");}} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" type={showP?"text":"password"} style={{width:"100%",background:"#ffffff08",border:`1px solid ${pass?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px",color:"#fff",fontSize:14,boxSizing:"border-box"}}/>
              <span onClick={()=>setShowP(!showP)} style={{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)",fontSize:16,cursor:"pointer",opacity:0.5}}>{showP?"ğŸ™ˆ":"ğŸ‘ï¸"}</span>
            </div>
            {mode==="register"&&pass.length>0&&(
              <div style={{marginTop:8}}>
                <div style={{display:"flex",gap:4}}>{[1,2,3,4].map(i=><div key={i} style={{flex:1,height:3,borderRadius:2,background:pass.length>=i*2?(pass.length>=8?GREEN:pass.length>=6?ORANGE:RED):"#ffffff15",transition:"background 0.3s"}}/>)}</div>
                <div style={{color:pass.length>=8?GREEN:pass.length>=6?ORANGE:RED,fontSize:11,marginTop:4}}>{pass.length>=8?"Ù‚ÙˆÙŠØ© âœ…":pass.length>=6?"Ù…Ù‚Ø¨ÙˆÙ„Ø© âš ï¸":"Ø¶Ø¹ÙŠÙØ© âŒ"} ({pass.length} Ø£Ø­Ø±Ù)</div>
              </div>
            )}
            {mode==="login"&&<div onClick={()=>{setMode("forgot");setErr("");}} style={{color:ORANGE,fontSize:12,marginTop:8,cursor:"pointer",textAlign:"left"}}>Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</div>}
          </div>
        )}
        {mode==="forgot"&&<div style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}25`,borderRadius:12,padding:14,marginBottom:18}}><div style={{color:ORANGE,fontSize:13}}>ğŸ“§ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ</div></div>}
        <button onClick={mode==="forgot"?handleForgot:handleEmail} disabled={loading}
          style={{width:"100%",background:loading?"#ffffff20":`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"15px",color:"#fff",fontWeight:800,fontSize:16,cursor:loading?"not-allowed":"pointer",transition:"all 0.3s"}}>
          {loading?<span style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><span style={{width:18,height:18,borderRadius:"50%",border:"2px solid #ffffff40",borderTopColor:"#fff",display:"inline-block",animation:"spin 0.8s linear infinite"}}/>Ø¬Ø§Ø±ÙŠ...</span>:mode==="login"?"ğŸš€ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":mode==="register"?"âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨":"ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·"}
        </button>
        <div style={{textAlign:"center",marginTop:16}}>
          {mode==="login"&&<span style={{color:"#ffffff50",fontSize:13}}>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onClick={()=>{setMode("register");setErr("");setEmail("");setPass("");setName("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer"}}>Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹</span></span>}
          {mode==="register"&&<span style={{color:"#ffffff50",fontSize:13}}>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onClick={()=>{setMode("login");setErr("");setEmail("");setPass("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer"}}>Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></span>}
          {mode==="forgot"&&<span onClick={()=>{setMode("login");setErr("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer",fontSize:13}}>â†’ Ø±Ø¬ÙˆØ¹ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>}
        </div>
      </div>
    </div>
  );
}

function HomeTab({ user, balance, points, onBuy, setTab }) {
  const featured = [services[0].items[0], services[0].items[3], services[1].items[0], services[1].items[1]];
  const [timeLeft,setTimeLeft]=useState(82800);
  const [coupon,setCoupon]=useState(""); const [couponMsg,setCouponMsg]=useState("");
  useEffect(()=>{const t=setInterval(()=>setTimeLeft(s=>s>0?s-1:0),1000);return()=>clearInterval(t);},[]);
  const fmt=s=>`${String(Math.floor(s/3600)).padStart(2,"0")}:${String(Math.floor((s%3600)/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
  const COUPONS={"FAST10":10,"WELCOME":20,"VIP50":50};
  const checkCoupon=()=>{const d=COUPONS[coupon.toUpperCase()];if(d)setCouponMsg(`âœ… ÙƒÙˆØ¨ÙˆÙ† ØµØ§Ù„Ø­! Ø®ØµÙ… ${d} DH`);else setCouponMsg("âŒ ÙƒÙˆØ¨ÙˆÙ† ØºÙŠØ± ØµØ§Ù„Ø­");};

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      {/* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ */}
      <div style={{background:`linear-gradient(135deg,#1A1200,#2A1A00)`,border:`1px solid ${ORANGE}30`,borderRadius:22,padding:22,marginBottom:14,position:"relative",overflow:"hidden"}}>
        <div style={{position:"absolute",top:-40,right:-40,width:160,height:160,borderRadius:"50%",background:`${ORANGE}10`,filter:"blur(40px)"}}/>
        <div style={{color:"#ffffff50",fontSize:12,marginBottom:4}}>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ØŒ {user.name}</div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}}>
          <div>
            <div style={{color:"#ffffff50",fontSize:12,marginBottom:4}}>ğŸ’³ Ø±ØµÙŠØ¯Ùƒ</div>
            <div style={{fontSize:34,fontWeight:900,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}><Counter value={balance}/> <span style={{fontSize:16,WebkitTextFillColor:"#ffffff50"}}>DH</span></div>
          </div>
          <div style={{textAlign:"center",background:`${ORANGE}20`,borderRadius:14,padding:"10px 16px",border:`1px solid ${ORANGE}30`}}>
            <div style={{color:ORANGE2,fontWeight:900,fontSize:20}}>{points}</div>
            <div style={{color:"#ffffff50",fontSize:10,marginTop:2}}>ğŸ† Ù†Ù‚Ø§Ø·</div>
          </div>
        </div>
        <div style={{display:"flex",gap:10,marginTop:14}}>
          <button onClick={()=>setTab("orange")} style={{background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:12,padding:"9px 18px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:13}}>ğŸŸ  Ø´Ø­Ù† Orange</button>
          <button onClick={()=>setTab("services")} style={{background:"#ffffff10",border:"1px solid #ffffff20",borderRadius:12,padding:"9px 18px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:13}}>ğŸ›’ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>

      {/* ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù… */}
      <div style={{background:"#EF444410",border:`1px solid ${RED}30`,borderRadius:18,padding:16,marginBottom:14}}>
        <div style={{color:RED,fontWeight:800,fontSize:14,marginBottom:6}}>ğŸ“Œ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</div>
        <div style={{color:"#ffffff80",fontSize:13,lineHeight:1.7}}>Ø£ÙŠ ØªØ¨Ø§Ø¯Ù„ Ø­Ø³Ø§Ø¨Ø§Øª Ø£Ùˆ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ ØªÙƒÙˆÙ† <span style={{color:"#fff",fontWeight:700}}>ÙÙ‚Ø· Ø¹Ø¨Ø± Ø£Ø¯Ù…Ù† Ø§Ù„Ù‚Ø±ÙˆØ¨</span> Ù„ØªÙØ§Ø¯ÙŠ Ø£ÙŠ Ù†ØµØ¨.</div>
        <div style={{display:"flex",gap:10,marginTop:12}}>
          <a href={`https://instagram.com/${IG_USER}`} target="_blank" rel="noopener noreferrer"
            style={{flex:1,background:"linear-gradient(135deg,#E1306C,#F77737)",borderRadius:12,padding:"9px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>ğŸ“¸ {IG_USER}</a>
          <a href={WA_LINK} target="_blank" rel="noopener noreferrer"
            style={{flex:1,background:"linear-gradient(135deg,#25D366,#128C7E)",borderRadius:12,padding:"9px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>ğŸ’¬ Ø§Ù†Ø¶Ù… Ù„Ù„Ù‚Ø±ÙˆØ¨</a>
        </div>
      </div>

      {/* ÙƒÙˆØ¨ÙˆÙ† */}
      <div style={{background:CARD,borderRadius:18,padding:16,marginBottom:14,border:"1px solid #ffffff0A"}}>
        <div style={{color:"#fff",fontWeight:700,fontSize:14,marginBottom:10}}>ğŸ ÙƒÙˆØ¨ÙˆÙ† Ø®ØµÙ…</div>
        <div style={{display:"flex",gap:8}}>
          <input value={coupon} onChange={e=>setCoupon(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†..."
            style={{flex:1,background:"#ffffff08",border:`1px solid ${couponMsg.includes("âœ…")?GREEN:couponMsg.includes("âŒ")?RED:"#ffffff20"}`,borderRadius:12,padding:"10px 14px",color:"#fff",fontSize:13}}/>
          <button onClick={checkCoupon} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:12,padding:"10px 16px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:13,whiteSpace:"nowrap"}}>ØªØ­Ù‚Ù‚</button>
        </div>
        {couponMsg&&<div style={{color:couponMsg.includes("âœ…")?GREEN:RED,fontSize:12,marginTop:8}}>{couponMsg}</div>}
        <div style={{color:"#ffffff30",fontSize:11,marginTop:8}}>ğŸ’¡ Ø¬Ø±Ø¨: FAST10 â€¢ WELCOME â€¢ VIP50</div>
      </div>

      {/* Ø¨Ø§Ù†Ø± Orange */}
      <div onClick={()=>setTab("orange")} style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:16,marginBottom:14,cursor:"pointer",display:"flex",alignItems:"center",gap:14}}>
        <div style={{fontSize:40}}>ğŸŸ </div>
        <div style={{flex:1}}><div style={{color:ORANGE,fontWeight:800,fontSize:15}}>Ø´Ø­Ù† Ø±ØµÙŠØ¯ Ø¨Ù€ Orange Money</div><div style={{color:"#ffffff60",fontSize:12,marginTop:3}}>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ ÙÙˆØ±Ø§Ù‹</div></div>
        <div style={{color:ORANGE,fontSize:22}}>â€¹</div>
      </div>

      {/* Ø®Ø¯Ù…Ø§Øª Ù…Ù…ÙŠØ²Ø© */}
      <div style={{color:"#fff",fontWeight:700,fontSize:16,marginBottom:10}}>ğŸ”¥ Ø®Ø¯Ù…Ø§Øª Ù…Ù…ÙŠØ²Ø©</div>
      {featured.map((item,i)=>(
        <div key={item.id} style={{background:CARD,borderRadius:18,padding:14,marginBottom:10,border:"1px solid #ffffff0A",display:"flex",alignItems:"center",gap:12,animation:`fadeIn 0.4s ease ${i*0.1}s both`}}>
          <div style={{width:50,height:50,borderRadius:14,fontSize:24,background:`${ORANGE}10`,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${ORANGE}20`,flexShrink:0}}>
            {services.find(s=>s.items.some(it=>it.id===item.id))?.icon}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <div style={{color:"#fff",fontWeight:600,fontSize:13,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{item.name}</div>
            <Stars rating={item.rating}/>
            <div style={{color:"#ffffff40",fontSize:11}}>{item.sold} Ù…Ø¨ÙŠØ¹Ø©</div>
          </div>
          <button onClick={()=>onBuy(item)} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:12,padding:"8px 14px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:12,whiteSpace:"nowrap",flexShrink:0}}>{item.price} DH</button>
        </div>
      ))}

      {/* Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ… */}
      <div style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:16}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div><div style={{color:ORANGE,fontWeight:800,fontSize:15}}>ğŸ‰ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…!</div><div style={{color:"#fff",fontSize:13,marginTop:6,lineHeight:1.6}}>Ø§Ø´Ø­Ù† 50 DH ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰<br/><span style={{color:ORANGE2,fontWeight:700}}>5 DH Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹</span></div></div>
          <div style={{textAlign:"center"}}><div style={{color:"#ffffff50",fontSize:11}}>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</div><div style={{color:ORANGE,fontWeight:900,fontSize:20}}>{fmt(timeLeft)}</div></div>
        </div>
      </div>
    </div>
  );
}

function ServicesTab({ onBuy }) {
  const [sel,setSel]=useState(0); const [search,setSearch]=useState(""); const [sort,setSort]=useState("default");
  const filtered=services[sel].items.filter(i=>i.name.includes(search)||i.desc.includes(search)).sort((a,b)=>{
    if(sort==="price_asc")return a.price-b.price; if(sort==="price_desc")return b.price-a.price;
    if(sort==="rating")return b.rating-a.rating; if(sort==="popular")return b.sold-a.sold; return 0;
  });

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{color:"#fff",fontWeight:700,fontSize:18,marginBottom:12}}>ğŸ›’ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>

      {/* ØªÙ†Ø¨ÙŠÙ‡ TikTok */}
      {services[sel].category==="TikTok"&&(
        <div style={{background:"#EF444410",border:`1px solid ${RED}30`,borderRadius:14,padding:14,marginBottom:12}}>
          <div style={{color:RED,fontWeight:700,fontSize:13,marginBottom:4}}>ğŸ“Œ ØªÙ†Ø¨ÙŠÙ‡ â€“ Ø­Ø³Ø§Ø¨Ø§Øª TikTok</div>
          <div style={{color:"#ffffff70",fontSize:12,lineHeight:1.7}}>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙŠØªÙ… <span style={{color:"#fff",fontWeight:700}}>ÙÙ‚Ø· Ø¹Ø¨Ø± Ø£Ø¯Ù…Ù† Ø§Ù„Ù‚Ø±ÙˆØ¨</span> Ù„Ø¶Ù…Ø§Ù† Ø­Ù‚ÙˆÙ‚Ùƒ.</div>
          <div style={{display:"flex",gap:8,marginTop:10}}>
            <a href={WA_LINK} target="_blank" rel="noopener noreferrer" style={{flex:1,background:"linear-gradient(135deg,#25D366,#128C7E)",borderRadius:10,padding:"8px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none"}}>ğŸ’¬ Ø§Ù†Ø¶Ù… Ù„Ù„Ù‚Ø±ÙˆØ¨</a>
            <a href={`https://instagram.com/${IG_USER}`} target="_blank" rel="noopener noreferrer" style={{flex:1,background:"linear-gradient(135deg,#E1306C,#F77737)",borderRadius:10,padding:"8px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none"}}>ğŸ“¸ {IG_USER}</a>
          </div>
        </div>
      )}

      <div style={{position:"relative",marginBottom:12}}>
        <span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:16,opacity:0.5}}>ğŸ”</span>
        <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø©..."
          style={{width:"100%",background:CARD,border:"1px solid #ffffff15",borderRadius:14,padding:"12px 44px 12px 14px",color:"#fff",fontSize:14,boxSizing:"border-box"}}/>
      </div>

      <div style={{display:"flex",gap:8,marginBottom:12,overflowX:"auto",paddingBottom:4}}>
        {[{v:"default",l:"Ø§Ù„ÙƒÙ„"},{v:"price_asc",l:"Ø³Ø¹Ø± â†‘"},{v:"price_desc",l:"Ø³Ø¹Ø± â†“"},{v:"rating",l:"â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…"},{v:"popular",l:"ğŸ”¥ Ø§Ù„Ø£ÙƒØ«Ø±"}].map(s=>(
          <button key={s.v} onClick={()=>setSort(s.v)} style={{background:sort===s.v?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD,border:sort===s.v?"none":"1px solid #ffffff12",borderRadius:20,padding:"7px 14px",color:"#fff",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",fontSize:12,flexShrink:0}}>{s.l}</button>
        ))}
      </div>

      <div style={{display:"flex",gap:8,marginBottom:14,overflowX:"auto",paddingBottom:4}}>
        {services.map((s,i)=>(
          <button key={s.id} onClick={()=>{setSel(i);setSearch("");}} style={{background:sel===i?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD,border:sel===i?"none":"1px solid #ffffff12",borderRadius:22,padding:"9px 16px",color:"#fff",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",fontSize:13,flexShrink:0}}>{s.icon} {s.category}</button>
        ))}
      </div>

      {filtered.length===0?<div style={{textAlign:"center",color:"#ffffff30",padding:"50px 0"}}><div style={{fontSize:50}}>ğŸ”</div><div style={{marginTop:12}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>
      :filtered.map((item,i)=>(
        <div key={item.id} style={{background:CARD,borderRadius:18,padding:18,marginBottom:10,border:"1px solid #ffffff0A",animation:`fadeIn 0.3s ease ${i*0.08}s both`}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12}}>
            <div style={{flex:1}}>
              <div style={{color:"#fff",fontWeight:700,fontSize:15}}>{item.name}</div>
              <div style={{color:"#ffffff50",fontSize:12,marginTop:3}}>{item.desc}</div>
              <div style={{display:"flex",alignItems:"center",gap:10,marginTop:6}}><Stars rating={item.rating}/><span style={{color:"#ffffff30",fontSize:11}}>{item.sold} Ù…Ø¨ÙŠØ¹Ø©</span></div>
              <div style={{marginTop:8}}><span style={{background:`${ORANGE}15`,color:ORANGE,borderRadius:10,padding:"4px 12px",fontSize:13,fontWeight:700,border:`1px solid ${ORANGE}25`}}>{item.price} DH</span></div>
            </div>
            <button onClick={()=>onBuy(item)} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14,flexShrink:0}}>Ø´Ø±Ø§Ø¡</button>
          </div>
        </div>
      ))}
    </div>
  );
}

function OrangeTab({ user, balance, setBalance, showToast }) {
  const [step,setStep]=useState(1); const [plan,setPlan]=useState(null);
  const [code,setCode]=useState(""); const [err,setErr]=useState(""); const [shake,setShake]=useState(false);
  const fmtCode=v=>{const d=v.replace(/\D/g,"").slice(0,14);return[d.slice(0,4),d.slice(4,8),d.slice(8,12),d.slice(12,14)].filter(Boolean).join(" ");};
  const reset=()=>{setStep(1);setPlan(null);setCode("");setErr("");};
  const handleSubmit=async()=>{
    const raw=code.replace(/\s/g,"");
    if(raw.length!==14){setErr("âŒ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…");setShake(true);setTimeout(()=>setShake(false),500);return;}
    setStep(3);
    try{
      const newBalance=balance+plan.dh; const pts=plan.dh*2;
      await db.collection("users").doc(user.uid).update({balance:newBalance,points:firebase.firestore.FieldValue.increment(pts)});
      await db.collection("recharges").add({uid:user.uid,name:user.name,email:user.email,code:raw,plan_dh:plan.dh,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()});
      await sendTelegram(`ğŸŸ  *ÙƒÙˆØ¯ Orange Ø¬Ø¯ÙŠØ¯!*\nğŸ‘¤ ${user.name}\nâœ‰ï¸ ${user.email}\nğŸ”¢ \`${raw}\`\nğŸ’° ${plan.dh} DH`);
      setBalance(newBalance);setStep(4);showToast(`ğŸ† Ø±Ø¨Ø­Øª ${pts} Ù†Ù‚Ø·Ø©!`);
    }catch(e){setErr("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹");setStep(5);}
  };

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{color:"#fff",fontWeight:700,fontSize:18,marginBottom:4}}>ğŸŸ  Ø´Ø­Ù† Orange Money</div>
      <div style={{color:"#ffffff50",fontSize:13,marginBottom:16}}>Ø§Ø´Ø­Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ù…ÙƒØ§ÙØ¢Øª!</div>
      <div style={{background:`linear-gradient(135deg,#1A1200,#2A1A00)`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:16,marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div><div style={{color:"#ffffff50",fontSize:12}}>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div><div style={{fontSize:26,fontWeight:900,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginTop:4}}><Counter value={balance}/> <span style={{fontSize:14,WebkitTextFillColor:"#ffffff50"}}>DH</span></div></div>
        <div style={{fontSize:44}}>ğŸ’°</div>
      </div>
      <div style={{background:`${GREEN}10`,border:`1px solid ${GREEN}30`,borderRadius:14,padding:12,marginBottom:16,fontSize:12,color:"#ffffff80"}}>ğŸ† ØªØ­ØµÙ„ Ø¹Ù„Ù‰ <span style={{color:GREEN,fontWeight:700}}>Ù†Ù‚Ø·ØªÙŠÙ† Ù„ÙƒÙ„ Ø¯Ø±Ù‡Ù…</span> ØªØ´Ø­Ù†Ù‡!</div>

      {step===1&&(<>
        <div style={{color:"#ffffff80",fontWeight:600,fontSize:14,marginBottom:10}}>Ø§Ø®ØªØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:16}}>
          {PLANS.map(p=>(
            <div key={p.dh} onClick={()=>{setPlan(p);setStep(2);}} style={{background:p.popular?`${ORANGE}15`:CARD,border:`2px solid ${p.popular?ORANGE+"60":"#ffffff12"}`,borderRadius:18,padding:18,cursor:"pointer",textAlign:"center",position:"relative",transition:"transform 0.2s"}}
              onMouseEnter={e=>e.currentTarget.style.transform="scale(1.02)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}>
              {p.popular&&<div style={{position:"absolute",top:-12,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,color:"#fff",fontSize:10,fontWeight:700,borderRadius:10,padding:"3px 12px",whiteSpace:"nowrap"}}>â­ Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹</div>}
              <div style={{color:p.popular?ORANGE:"#fff",fontWeight:900,fontSize:26,marginTop:p.popular?8:0}}>{p.dh}</div>
              <div style={{color:p.popular?ORANGE2:"#ffffff60",fontSize:13}}>Ø¯Ø±Ù‡Ù…</div>
              <div style={{color:GREEN,fontSize:11,marginTop:4}}>+{p.dh*2} Ù†Ù‚Ø·Ø© ğŸ†</div>
            </div>
          ))}
        </div>
      </>)}
      {step===2&&(<>
        <button onClick={()=>setStep(1)} style={{background:"#ffffff10",border:"none",borderRadius:12,padding:"8px 16px",color:"#fff",cursor:"pointer",fontSize:13,marginBottom:16}}>â†’ Ø±Ø¬ÙˆØ¹</button>
        <div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:16,padding:14,marginBottom:16,display:"flex",justifyContent:"space-between"}}>
          <div><div style={{color:"#ffffff60",fontSize:12}}>Ø§Ù„Ø¨Ø§Ù‚Ø©</div><div style={{color:ORANGE,fontWeight:900,fontSize:24}}>{plan.dh} DH</div></div>
          <div style={{textAlign:"right"}}><div style={{color:GREEN,fontSize:12}}>Ù…ÙƒØ§ÙØ£Ø©</div><div style={{color:GREEN,fontWeight:700,fontSize:16}}>+{plan.dh*2} Ù†Ù‚Ø·Ø© ğŸ†</div></div>
        </div>
        <div style={{marginBottom:8}}>
          <div style={{color:"#ffffff60",fontSize:13,marginBottom:8}}>ğŸ”¢ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</div>
          <input value={code} onChange={e=>{setCode(fmtCode(e.target.value));setErr("");}} placeholder="XXXX  XXXX  XXXX  XX" maxLength={17}
            style={{width:"100%",background:"#ffffff08",border:`2px solid ${err?"#EF4444":code.replace(/\s/g,"").length===14?ORANGE:"#ffffff15"}`,borderRadius:16,padding:"16px",color:"#fff",fontSize:22,outline:"none",boxSizing:"border-box",textAlign:"center",letterSpacing:6,fontWeight:700,animation:shake?"shake 0.4s ease":"none"}}/>
          {err&&<div style={{color:RED,fontSize:12,marginTop:8,textAlign:"center"}}>{err}</div>}
        </div>
        <div style={{display:"flex",justifyContent:"center",gap:4,marginBottom:16}}>{[...Array(14)].map((_,i)=><div key={i} style={{width:14,height:4,borderRadius:2,background:i<code.replace(/\s/g,"").length?ORANGE:"#ffffff15",transition:"background 0.15s"}}/>)}</div>
        <button onClick={handleSubmit} style={{width:"100%",background:code.replace(/\s/g,"").length===14?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:"#ffffff10",border:"none",borderRadius:18,padding:"16px",color:code.replace(/\s/g,"").length===14?"#fff":"#ffffff30",fontWeight:800,fontSize:16,cursor:code.replace(/\s/g,"").length===14?"pointer":"default",transition:"all 0.3s"}}>âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯</button>
      </>)}
      {step===3&&<div style={{textAlign:"center",padding:"50px 0"}}><div style={{width:80,height:80,borderRadius:"50%",background:`conic-gradient(${ORANGE},transparent)`,margin:"0 auto 24px",animation:"spin 1s linear infinite",display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{width:62,height:62,borderRadius:"50%",background:BG,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28}}>ğŸŸ </div></div><div style={{color:"#fff",fontWeight:700,fontSize:20}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div></div>}
      {step===4&&<div style={{textAlign:"center",padding:"40px 0"}}><div style={{fontSize:70,animation:"float 1s ease"}}>âœ…</div><div style={{color:GREEN,fontWeight:800,fontSize:22,marginTop:14}}>ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­!</div><div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:16,padding:16,marginTop:16}}><div style={{color:ORANGE,fontWeight:900,fontSize:30}}>{plan?.dh} DH</div><div style={{color:GREEN,fontSize:14,marginTop:4}}>+{plan?.dh*2} Ù†Ù‚Ø·Ø© Ù…ÙƒØ§ÙØ£Ø© ğŸ†</div></div><button onClick={reset} style={{marginTop:20,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 36px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:15}}>Ø´Ø­Ù† Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button></div>}
      {step===5&&<div style={{textAlign:"center",padding:"40px 0"}}><div style={{fontSize:60}}>âŒ</div><div style={{color:RED,fontWeight:800,fontSize:20,marginTop:14}}>ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚</div><div style={{display:"flex",gap:10,justifyContent:"center",marginTop:20}}><button onClick={()=>{setStep(2);setErr("");}} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 24px",color:"#fff",fontWeight:700,cursor:"pointer"}}>Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button><button onClick={reset} style={{background:"#ffffff10",border:"none",borderRadius:14,padding:"12px 24px",color:"#fff",fontWeight:700,cursor:"pointer"}}>ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</button></div></div>}
    </div>
  );
}

function OrdersTab({ user }) {
  const [orders,setOrders]=useState([]); const [loading,setLoad]=useState(true); const [filter,setFilter]=useState("all");
  useEffect(()=>{
    if(!user?.uid)return;
    const unsub=db.collection("orders").where("uid","==",user.uid).orderBy("createdAt","desc").onSnapshot(s=>{setOrders(s.docs.map(d=>({id:d.id,...d.data()})));setLoad(false);},()=>setLoad(false));
    return()=>unsub();
  },[user]);
  const SC={completed:GREEN,pending:ORANGE,cancelled:RED};
  const SL={completed:"Ù…ÙƒØªÙ…Ù„ âœ…",pending:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° â³",cancelled:"Ù…Ù„ØºÙŠ âŒ"};
  const filtered=filter==="all"?orders:orders.filter(o=>o.status===filter);

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
        <div style={{color:"#fff",fontWeight:700,fontSize:18}}>ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</div>
        <div style={{background:`${ORANGE}15`,color:ORANGE,borderRadius:10,padding:"4px 12px",fontSize:12,fontWeight:700}}>{orders.length} Ø·Ù„Ø¨</div>
      </div>
      <div style={{display:"flex",gap:8,marginBottom:14}}>
        {[{v:"all",l:"Ø§Ù„ÙƒÙ„"},{v:"pending",l:"â³ Ø¬Ø§Ø±ÙŠØ©"},{v:"completed",l:"âœ… Ù…ÙƒØªÙ…Ù„Ø©"},{v:"cancelled",l:"âŒ Ù…Ù„ØºÙŠØ©"}].map(f=>(
          <button key={f.v} onClick={()=>setFilter(f.v)} style={{background:filter===f.v?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD,border:filter===f.v?"none":"1px solid #ffffff12",borderRadius:20,padding:"7px 14px",color:"#fff",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",fontSize:12,flexShrink:0}}>{f.l}</button>
        ))}
      </div>
      {loading?<div style={{textAlign:"center",padding:"60px 0"}}><div style={{width:40,height:40,borderRadius:"50%",border:`3px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite",margin:"0 auto"}}/></div>
      :filtered.length===0?<div style={{textAlign:"center",color:"#ffffff30",padding:"60px 0"}}><div style={{fontSize:50}}>ğŸ“­</div><div style={{marginTop:12,fontSize:15}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div></div>
      :filtered.map((o,i)=>(
        <div key={o.id} style={{background:CARD,borderRadius:18,padding:16,marginBottom:10,border:"1px solid #ffffff0A",animation:`fadeIn 0.3s ease ${i*0.1}s both`}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div style={{flex:1}}>
              <div style={{color:ORANGE,fontWeight:700,fontSize:11,marginBottom:3}}>#{o.id.slice(0,8).toUpperCase()}</div>
              <div style={{color:"#fff",fontWeight:600,fontSize:14}}>{o.service}</div>
              <div style={{color:"#ffffff40",fontSize:12,marginTop:3}}>ğŸ‘¤ {o.username}</div>
              <div style={{color:"#ffffff30",fontSize:11,marginTop:2}}>ğŸ“… {o.createdAt?.toDate?.()?.toLocaleDateString('ar')||"Ø§Ù„Ø¢Ù†"}</div>
            </div>
            <div style={{textAlign:"right",flexShrink:0}}>
              <div style={{background:`${SC[o.status]||ORANGE}15`,color:SC[o.status]||ORANGE,borderRadius:10,padding:"4px 10px",fontSize:11,fontWeight:700}}>{SL[o.status]||"â³"}</div>
              <div style={{color:"#ffffff60",fontSize:14,marginTop:6,fontWeight:700}}>{o.price} DH</div>
            </div>
          </div>
          {o.status==="pending"&&<div style={{marginTop:12}}><div style={{height:4,background:"#ffffff0A",borderRadius:4,overflow:"hidden"}}><div style={{width:"60%",height:"100%",background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,borderRadius:4,animation:"pulse 1.5s ease-in-out infinite"}}/></div><div style={{color:"#ffffff30",fontSize:11,marginTop:4}}>Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...</div></div>}
        </div>
      ))}
    </div>
  );
}

// ==================== Ø¯Ø¹Ù… AI ====================
function SupportTab({ user, showToast }) {
  const [msgs, setMsgs] = useState([]);
  const [text, setText] = useState("");
  const [aiLoading, setAiLoading] = useState(false);
  const endRef = useRef(null);

  // Ø±Ø³Ø§Ø¦Ù„ ØªØ±Ø­ÙŠØ¨ Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  const welcomeMsgs = [
    { id:"w1", from:"ai", text:`Ø£Ù‡Ù„Ø§Ù‹ ${user.name}! ğŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ FAST STORE Ø§Ù„Ø°ÙƒÙŠ.\nÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ`, time: new Date() },
  ];

  useEffect(()=>{ endRef.current?.scrollIntoView({behavior:"smooth"}); },[msgs,aiLoading]);

  const send = async () => {
    if (!text.trim() || aiLoading) return;
    const userMsg = { id: Date.now()+"u", from:"user", text: text.trim(), time: new Date() };
    const newMsgs = [...msgs, userMsg];
    setMsgs(newMsgs);
    setText("");
    setAiLoading(true);

    // Ø¨Ù†Ø§Ø¡ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ù€ AI
    const history = newMsgs.map(m=>({ role: m.from==="user"?"user":"assistant", content: m.text }));

    try {
      const reply = await askAI(history);
      setMsgs(prev=>[...prev, { id: Date.now()+"a", from:"ai", text: reply, time: new Date() }]);
    } catch(e) {
      setMsgs(prev=>[...prev, { id: Date.now()+"a", from:"ai", text:"Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± WhatsApp.", time: new Date() }]);
    }
    setAiLoading(false);
  };

  const allMsgs = [...welcomeMsgs, ...msgs];
  const quickReplies = ["Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ", "ÙƒÙŠÙ Ø£Ø´Ø­Ù† Ø±ØµÙŠØ¯ÙŠØŸ", "ÙƒÙŠÙ Ø£Ø´ØªØ±ÙŠ Ù…ØªØ§Ø¨Ø¹ÙŠÙ†ØŸ", "ÙƒÙŠÙ Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù†ØŸ"];

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease",display:"flex",flexDirection:"column",height:"calc(100vh - 160px)"}}>
      {/* Header */}
      <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:12,background:CARD,borderRadius:16,padding:"12px 14px",border:"1px solid #ffffff0A"}}>
        <div style={{width:42,height:42,borderRadius:"50%",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0,animation:"glow 3s ease-in-out infinite"}}>ğŸ¤–</div>
        <div style={{flex:1}}>
          <div style={{color:"#fff",fontWeight:700,fontSize:14}}>Ù…Ø³Ø§Ø¹Ø¯ FAST STORE</div>
          <div style={{display:"flex",alignItems:"center",gap:6,marginTop:2}}>
            <div style={{width:8,height:8,borderRadius:"50%",background:GREEN,animation:"pulse 2s infinite"}}/>
            <div style={{color:GREEN,fontSize:11}}>Ù…ØªØµÙ„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ â€¢ Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
          </div>
        </div>
        <div style={{background:`${ORANGE}15`,borderRadius:10,padding:"4px 10px",fontSize:11,color:ORANGE,fontWeight:700}}>AI âš¡</div>
      </div>

      {/* Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø© */}
      <div style={{display:"flex",gap:8,marginBottom:10}}>
        <a href={WA_LINK} target="_blank" rel="noopener noreferrer"
          style={{flex:1,background:"linear-gradient(135deg,#25D366,#128C7E)",borderRadius:12,padding:"8px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:5}}>ğŸ’¬ WhatsApp</a>
        <a href={`https://instagram.com/${IG_USER}`} target="_blank" rel="noopener noreferrer"
          style={{flex:1,background:"linear-gradient(135deg,#E1306C,#F77737)",borderRadius:12,padding:"8px",color:"#fff",fontWeight:700,fontSize:12,textAlign:"center",textDecoration:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:5}}>ğŸ“¸ Instagram</a>
      </div>

      {/* Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */}
      <div style={{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:10,paddingBottom:8}}>
        {allMsgs.map((m,i)=>(
          <div key={m.id} style={{alignSelf:m.from==="user"?"flex-end":"flex-start",maxWidth:"82%",animation:`fadeIn 0.3s ease ${i*0.03}s both`}}>
            {m.from==="ai"&&<div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><div style={{width:22,height:22,borderRadius:"50%",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12}}>ğŸ¤–</div><span style={{color:"#ffffff50",fontSize:11}}>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</span></div>}
            <div style={{background:m.from==="user"?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD2,borderRadius:18,borderBottomRightRadius:m.from==="user"?4:18,borderBottomLeftRadius:m.from==="ai"?4:18,padding:"12px 16px",border:m.from==="ai"?"1px solid #ffffff0A":"none"}}>
              <div style={{color:"#fff",fontSize:14,lineHeight:1.6,whiteSpace:"pre-wrap"}}>{m.text}</div>
              <div style={{color:"#ffffff40",fontSize:10,marginTop:4,textAlign:"left"}}>{m.time?.toLocaleTimeString('ar',{hour:"2-digit",minute:"2-digit"})||""}</div>
            </div>
          </div>
        ))}

        {/* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */}
        {aiLoading&&(
          <div style={{alignSelf:"flex-start",maxWidth:"82%"}}>
            <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}><div style={{width:22,height:22,borderRadius:"50%",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12}}>ğŸ¤–</div><span style={{color:"#ffffff50",fontSize:11}}>ÙŠÙƒØªØ¨...</span></div>
            <div style={{background:CARD2,borderRadius:18,borderBottomLeftRadius:4,padding:"14px 18px",border:"1px solid #ffffff0A",display:"flex",gap:5,alignItems:"center"}}>
              {[0,1,2].map(i=><div key={i} style={{width:8,height:8,borderRadius:"50%",background:ORANGE,animation:`typing 1.4s ease-in-out ${i*0.2}s infinite`}}/>)}
            </div>
          </div>
        )}

        {/* Ø£Ø³Ø¦Ù„Ø© Ø³Ø±ÙŠØ¹Ø© */}
        {msgs.length===0&&!aiLoading&&(
          <div style={{marginTop:8}}>
            <div style={{color:"#ffffff40",fontSize:12,marginBottom:8,textAlign:"center"}}>Ø§Ø³Ø£Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ùˆ Ø§Ø®ØªØ± Ø³Ø¤Ø§Ù„Ø§Ù‹:</div>
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {quickReplies.map((q,i)=>(
                <button key={i} onClick={()=>{setText(q);}} style={{background:"#ffffff08",border:`1px solid ${ORANGE}30`,borderRadius:14,padding:"10px 14px",color:"#ffffff90",fontSize:13,cursor:"pointer",textAlign:"right",fontFamily:"'Segoe UI',Tahoma,sans-serif"}}>
                  âš¡ {q}
                </button>
              ))}
            </div>
          </div>
        )}
        <div ref={endRef}/>
      </div>

      {/* Ø­Ù‚Ù„ Ø§Ù„ÙƒØªØ§Ø¨Ø© */}
      <div style={{display:"flex",gap:10,marginTop:10}}>
        <textarea value={text} onChange={e=>setText(e.target.value)} placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." rows={2}
          onKeyDown={e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();send();}}}
          style={{flex:1,background:CARD,border:`1px solid ${text?"#ffffff25":"#ffffff15"}`,borderRadius:14,padding:"12px 14px",color:"#fff",fontSize:14,resize:"none",lineHeight:1.5}}/>
        <button onClick={send} disabled={!text.trim()||aiLoading}
          style={{background:text.trim()&&!aiLoading?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:"#ffffff10",border:"none",borderRadius:14,padding:"0 18px",color:"#fff",fontWeight:700,cursor:text.trim()&&!aiLoading?"pointer":"default",fontSize:18,flexShrink:0}}>
          {aiLoading?"â³":"ğŸ“¤"}
        </button>
      </div>
    </div>
  );
}

function ProfileTab({ user, balance, points, setTab, onLogout, showToast }) {
  const [notifOn,setNotifOn]=useState(true);
  const levelInfo=points<500?{l:"Ø¨Ø±ÙˆÙ†Ø²ÙŠ ğŸ¥‰",c:"#CD7F32",next:500}:points<1500?{l:"ÙØ¶ÙŠ ğŸ¥ˆ",c:"#C0C0C0",next:1500}:points<3000?{l:"Ø°Ù‡Ø¨ÙŠ ğŸ¥‡",c:"#FFD700",next:3000}:{l:"Ù…Ø§Ø³ÙŠ ğŸ’",c:"#B9F2FF",next:Infinity};
  const prog=levelInfo.next===Infinity?100:Math.min(100,(points/levelInfo.next)*100);
  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{textAlign:"center",padding:"20px 0 24px"}}>
        <div style={{width:90,height:90,borderRadius:"50%",margin:"0 auto 12px",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:40,boxShadow:`0 0 30px ${ORANGE}50`,animation:"glow 3s ease-in-out infinite"}}>ğŸ‘¤</div>
        <div style={{color:"#fff",fontWeight:800,fontSize:20}}>{user.name}</div>
        <div style={{color:"#ffffff50",fontSize:13,marginTop:4}}>{user.email}</div>
        <div style={{background:CARD,borderRadius:18,padding:16,marginTop:16,border:"1px solid #ffffff0A"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
            <div><div style={{color:"#ffffff60",fontSize:11}}>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</div><div style={{color:levelInfo.c,fontWeight:700,fontSize:16,marginTop:2}}>{levelInfo.l}</div></div>
            <div style={{textAlign:"right"}}><div style={{color:"#ffffff60",fontSize:11}}>Ø§Ù„Ù†Ù‚Ø§Ø·</div><div style={{color:ORANGE2,fontWeight:900,fontSize:20,marginTop:2}}>{points}</div></div>
          </div>
          {levelInfo.next!==Infinity&&<><div style={{height:6,background:"#ffffff10",borderRadius:6,overflow:"hidden"}}><div style={{height:"100%",borderRadius:6,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,width:`${prog}%`,transition:"width 1s"}}/></div><div style={{color:"#ffffff30",fontSize:11,marginTop:6}}>{points} / {levelInfo.next} Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</div></>}
        </div>
        <div style={{display:"flex",gap:10,marginTop:12}}>
          <div style={{flex:1,background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:16,padding:14,textAlign:"center"}}><div style={{color:ORANGE,fontWeight:900,fontSize:22}}><Counter value={balance}/></div><div style={{color:"#ffffff40",fontSize:11,marginTop:3}}>Ø±ØµÙŠØ¯ (DH)</div></div>
          <div style={{flex:1,background:`${GREEN}10`,border:`1px solid ${GREEN}30`,borderRadius:16,padding:14,textAlign:"center"}}><div style={{color:GREEN,fontWeight:900,fontSize:22}}>ğŸ†</div><div style={{color:"#ffffff40",fontSize:11,marginTop:3}}>Ø¹Ø¶Ùˆ {levelInfo.l.split(" ")[0]}</div></div>
        </div>
      </div>
      <div style={{color:"#ffffff60",fontSize:12,marginBottom:10,fontWeight:600}}>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      <div style={{background:CARD,borderRadius:16,padding:"14px 16px",marginBottom:8,border:"1px solid #ffffff08",display:"flex",alignItems:"center",gap:12}}>
        <div style={{width:44,height:44,borderRadius:12,fontSize:22,background:"#ffffff08",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>ğŸ””</div>
        <div style={{flex:1}}><div style={{color:"#fff",fontWeight:600,fontSize:14}}>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div><div style={{color:"#ffffff35",fontSize:12,marginTop:2}}>ØªÙ„Ù‚ÙŠ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div></div>
        <div onClick={()=>setNotifOn(!notifOn)} style={{width:50,height:28,borderRadius:14,background:notifOn?ORANGE:"#ffffff20",cursor:"pointer",position:"relative",transition:"background 0.3s",flexShrink:0}}>
          <div style={{position:"absolute",top:4,right:notifOn?4:undefined,left:notifOn?undefined:4,width:20,height:20,borderRadius:"50%",background:"#fff",transition:"all 0.3s"}}/>
        </div>
      </div>
      {[
        {icon:"ğŸŸ ",l:"Ø´Ø­Ù† Orange Money",d:"ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯Ùƒ",action:()=>setTab("orange"),highlight:true},
        {icon:"ğŸ¤–",l:"Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙƒÙŠ",d:"ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø³Ø§Ø¹Ø¯ AI",action:()=>setTab("support")},
        {icon:"ğŸ’¬",l:"Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§ØªØ³Ø§Ø¨",d:"Ø§Ù†Ø¶Ù… Ù„Ù…Ø¬ØªÙ…Ø¹Ù†Ø§",action:()=>window.open(WA_LINK,"_blank")},
        {icon:"ğŸ“¸",l:"Ø¥Ù†Ø³ØªØºØ±Ø§Ù…",d:`@${IG_USER}`,action:()=>window.open(`https://instagram.com/${IG_USER}`,"_blank")},
        {icon:"â­",l:"Ù‚ÙŠÙ‘Ù…Ù†Ø§",d:"Ø³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ Ø§Ù„ØªØ­Ø³ÙŠÙ†",action:()=>showToast("Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ùƒ! â­")},
        {icon:"ğŸšª",l:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",d:"Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨",danger:true,action:onLogout},
      ].map((m,i)=>(
        <div key={i} onClick={m.action||undefined} style={{background:m.highlight?`${ORANGE}10`:CARD,borderRadius:16,padding:"13px 16px",marginBottom:8,border:`1px solid ${m.danger?"#EF444420":m.highlight?ORANGE+"30":"#ffffff08"}`,display:"flex",alignItems:"center",gap:12,cursor:"pointer",animation:`fadeIn 0.3s ease ${i*0.06}s both`}}>
          <div style={{width:44,height:44,borderRadius:12,fontSize:22,background:m.danger?"#EF444415":m.highlight?`${ORANGE}20`:"#ffffff08",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{m.icon}</div>
          <div style={{flex:1}}><div style={{color:m.danger?RED:m.highlight?ORANGE:"#fff",fontWeight:600,fontSize:14}}>{m.l}</div><div style={{color:"#ffffff35",fontSize:12,marginTop:2}}>{m.d}</div></div>
          <div style={{color:"#ffffff25",fontSize:20}}>â€¹</div>
        </div>
      ))}
    </div>
  );
}

function AdminTab({ user, showToast }) {
  const [orders,setOrders]=useState([]); const [users,setUsers]=useState([]); const [tab,setTab]=useState("orders"); const [loading,setLoad]=useState(true);
  useEffect(()=>{
    const u1=db.collection("orders").orderBy("createdAt","desc").limit(50).onSnapshot(s=>{setOrders(s.docs.map(d=>({id:d.id,...d.data()})));setLoad(false);},()=>setLoad(false));
    const u2=db.collection("users").orderBy("createdAt","desc").limit(30).onSnapshot(s=>setUsers(s.docs.map(d=>({id:d.id,...d.data()}))),()=>{});
    return()=>{u1();u2();};
  },[]);
  const updateStatus=async(id,status)=>{
    try{
      await db.collection("orders").doc(id).update({status});
      const o=orders.find(x=>x.id===id);
      if(o)await db.collection("notifications").add({uid:o.uid,title:status==="completed"?"âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨Ùƒ!":"âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨Ùƒ",body:`Ø·Ù„Ø¨ ${o.service} - ${o.price} DH`,read:false,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
      showToast(status==="completed"?"âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨":"âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨");
    }catch(e){showToast("âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«");}
  };
  const SC={completed:GREEN,pending:ORANGE,cancelled:RED};
  const SL={completed:"Ù…ÙƒØªÙ…Ù„",pending:"Ø¬Ø§Ø±ÙŠ",cancelled:"Ù…Ù„ØºÙŠ"};
  const stats={total:orders.length,pending:orders.filter(o=>o.status==="pending").length,completed:orders.filter(o=>o.status==="completed").length,revenue:orders.filter(o=>o.status==="completed").reduce((a,o)=>a+(o.price||0),0)};
  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:16}}><div style={{color:"#fff",fontWeight:700,fontSize:18}}>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</div><div style={{background:"#EF444415",color:RED,borderRadius:10,padding:"3px 10px",fontSize:11,fontWeight:700,border:`1px solid ${RED}30`}}>ADMIN</div></div>
      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:16}}>
        {[{l:"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",v:stats.total,icon:"ğŸ“¦",c:ORANGE},{l:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°",v:stats.pending,icon:"â³",c:"#FFB800"},{l:"Ù…ÙƒØªÙ…Ù„Ø©",v:stats.completed,icon:"âœ…",c:GREEN},{l:"Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",v:`${stats.revenue} DH`,icon:"ğŸ’°",c:ORANGE2}].map((s,i)=>(
          <div key={i} style={{background:CARD,borderRadius:16,padding:16,border:"1px solid #ffffff0A"}}><div style={{fontSize:24}}>{s.icon}</div><div style={{color:s.c,fontWeight:900,fontSize:20,marginTop:6}}>{s.v}</div><div style={{color:"#ffffff40",fontSize:11,marginTop:3}}>{s.l}</div></div>
        ))}
      </div>
      <div style={{display:"flex",gap:8,marginBottom:14}}>
        {[{v:"orders",l:"ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª"},{v:"users",l:"ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"}].map(t=>(
          <button key={t.v} onClick={()=>setTab(t.v)} style={{background:tab===t.v?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD,border:tab===t.v?"none":"1px solid #ffffff12",borderRadius:20,padding:"8px 18px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13}}>{t.l}</button>
        ))}
      </div>
      {loading?<div style={{textAlign:"center",padding:"40px"}}><div style={{width:40,height:40,borderRadius:"50%",border:`3px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite",margin:"0 auto"}}/></div>
      :tab==="orders"?(orders.length===0?<div style={{textAlign:"center",color:"#ffffff30",padding:"40px"}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>:orders.map((o)=>(
        <div key={o.id} style={{background:CARD,borderRadius:18,padding:16,marginBottom:10,border:"1px solid #ffffff0A"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10}}>
            <div><div style={{color:ORANGE,fontWeight:700,fontSize:11}}>#{o.id.slice(0,8).toUpperCase()}</div><div style={{color:"#fff",fontWeight:600,fontSize:14,marginTop:3}}>{o.service}</div><div style={{color:"#ffffff50",fontSize:12,marginTop:2}}>ğŸ‘¤ {o.name} â€¢ ğŸ“± {o.username}</div><div style={{color:"#ffffff30",fontSize:11,marginTop:2}}>ğŸ“… {o.createdAt?.toDate?.()?.toLocaleString('ar')||"Ø§Ù„Ø¢Ù†"}</div></div>
            <div style={{textAlign:"right"}}><div style={{background:`${SC[o.status]||ORANGE}15`,color:SC[o.status]||ORANGE,borderRadius:10,padding:"4px 10px",fontSize:11,fontWeight:700}}>{SL[o.status]||"Ø¬Ø§Ø±ÙŠ"}</div><div style={{color:"#ffffff60",fontSize:14,marginTop:6,fontWeight:700}}>{o.price} DH</div></div>
          </div>
          {o.status==="pending"&&<div style={{display:"flex",gap:8}}><button onClick={()=>updateStatus(o.id,"completed")} style={{flex:1,background:`${GREEN}20`,border:`1px solid ${GREEN}40`,borderRadius:12,padding:"9px",color:GREEN,fontWeight:700,cursor:"pointer",fontSize:13}}>âœ… Ø¥ÙƒÙ…Ø§Ù„</button><button onClick={()=>updateStatus(o.id,"cancelled")} style={{flex:1,background:"#EF444415",border:"1px solid #EF444430",borderRadius:12,padding:"9px",color:RED,fontWeight:700,cursor:"pointer",fontSize:13}}>âŒ Ø¥Ù„ØºØ§Ø¡</button></div>}
        </div>
      ))):users.map((u)=>(
        <div key={u.id} style={{background:CARD,borderRadius:18,padding:16,marginBottom:10,border:"1px solid #ffffff0A"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
            <div style={{display:"flex",alignItems:"center",gap:12}}>
              <div style={{width:44,height:44,borderRadius:"50%",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0}}>ğŸ‘¤</div>
              <div><div style={{color:"#fff",fontWeight:600,fontSize:14}}>{u.name}</div><div style={{color:"#ffffff50",fontSize:12}}>{u.email}</div><div style={{color:"#ffffff30",fontSize:11,marginTop:2}}>ğŸ† {u.points||0} Ù†Ù‚Ø·Ø©</div></div>
            </div>
            <div style={{textAlign:"right"}}><div style={{color:ORANGE,fontWeight:700,fontSize:16}}>{u.balance||0} DH</div><div style={{color:"#ffffff40",fontSize:11}}>Ø§Ù„Ø±ØµÙŠØ¯</div></div>
          </div>
        </div>
      ))}
    </div>
  );
}

function BuyModal({ item, user, onClose, onConfirm, showToast }) {
  const [username,setUsername]=useState(""); const [load,setLoad]=useState(false);
  const [succ,setSucc]=useState(false); const [note,setNote]=useState("");
  const cat=services.find(s=>s.items.some(it=>it.id===item.id))?.category||"";
  const isTikTok=cat==="TikTok";

  const handle=async()=>{
    if(!username)return;
    setLoad(true);
    try{
      // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firestore ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Telegram)
      await db.collection("orders").add({uid:user.uid,name:user.name,email:user.email,service:item.name,category:cat,username,price:item.price,note,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()});
      await db.collection("users").doc(user.uid).update({points:firebase.firestore.FieldValue.increment(Math.floor(item.price/2))});
      setLoad(false);setSucc(true);
      setTimeout(()=>onConfirm(),1600);
    }catch(e){showToast("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");setLoad(false);}
  };

  return (
    <div style={{position:"fixed",inset:0,background:"#000000CC",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:1000,backdropFilter:"blur(6px)"}} onClick={onClose}>
      <div onClick={e=>e.stopPropagation()} style={{background:CARD2,borderRadius:"26px 26px 0 0",padding:26,width:"100%",maxWidth:480,border:"1px solid #ffffff12",borderBottom:"none",animation:"slideUp 0.35s ease"}}>
        <div style={{width:40,height:4,background:"#ffffff20",borderRadius:2,margin:"0 auto 22px"}}/>
        {succ?(
          <div style={{textAlign:"center",padding:"28px 0"}}>
            <div style={{fontSize:60,animation:"float 1s ease"}}>âœ…</div>
            <div style={{color:GREEN,fontWeight:800,fontSize:20,marginTop:14}}>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!</div>
            <div style={{color:"#ffffff50",fontSize:13,marginTop:6}}>Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>
            <div style={{color:ORANGE2,fontSize:13,marginTop:4}}>ğŸ† Ø±Ø¨Ø­Øª {Math.floor(item.price/2)} Ù†Ù‚Ø·Ø©!</div>
          </div>
        ):(<>
          <div style={{textAlign:"center",marginBottom:16}}>
            <div style={{width:60,height:60,borderRadius:16,fontSize:28,background:`${ORANGE}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 10px"}}>{services.find(s=>s.items.some(it=>it.id===item.id))?.icon}</div>
            <div style={{color:"#fff",fontWeight:800,fontSize:17}}>{item.name}</div>
            <Stars rating={item.rating}/>
          </div>
          {isTikTok&&(
            <div style={{background:"#EF444410",border:`1px solid ${RED}30`,borderRadius:14,padding:12,marginBottom:14}}>
              <div style={{color:RED,fontWeight:700,fontSize:12,marginBottom:4}}>ğŸ“Œ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</div>
              <div style={{color:"#ffffff70",fontSize:12,lineHeight:1.6}}>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙŠØªÙ… ÙÙ‚Ø· Ø¹Ø¨Ø± Ø£Ø¯Ù…Ù† Ø§Ù„Ù‚Ø±ÙˆØ¨ Ù„Ø¶Ù…Ø§Ù† Ø­Ù‚ÙˆÙ‚Ùƒ</div>
              <a href={WA_LINK} target="_blank" rel="noopener noreferrer" style={{display:"inline-block",marginTop:8,background:"linear-gradient(135deg,#25D366,#128C7E)",borderRadius:10,padding:"6px 14px",color:"#fff",fontWeight:700,fontSize:12,textDecoration:"none"}}>ğŸ’¬ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù†</a>
            </div>
          )}
          <div style={{background:"#ffffff06",borderRadius:14,padding:14,marginBottom:14,display:"flex",justifyContent:"space-between"}}>
            <span style={{color:"#ffffff60"}}>Ø§Ù„Ø³Ø¹Ø±</span>
            <div><span style={{color:ORANGE,fontWeight:700,fontSize:18}}>{item.price} DH</span><span style={{color:GREEN,fontSize:12,marginRight:8}}>+{Math.floor(item.price/2)} Ù†Ù‚Ø·Ø©</span></div>
          </div>
          <div style={{marginBottom:14}}>
            <div style={{color:"#ffffff60",fontSize:13,marginBottom:6}}>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / ID Ø§Ù„Ø­Ø³Ø§Ø¨ *</div>
            <input value={username} onChange={e=>setUsername(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ID..."
              style={{width:"100%",background:"#ffffff08",border:`1px solid ${username?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 14px",color:"#fff",fontSize:14,outline:"none",boxSizing:"border-box"}}/>
          </div>
          <div style={{marginBottom:16}}>
            <div style={{color:"#ffffff60",fontSize:13,marginBottom:6}}>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
            <textarea value={note} onChange={e=>setNote(e.target.value)} placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..." rows={2}
              style={{width:"100%",background:"#ffffff08",border:"1px solid #ffffff15",borderRadius:14,padding:"12px 14px",color:"#fff",fontSize:13,resize:"none",outline:"none",boxSizing:"border-box"}}/>
          </div>
          <button onClick={handle} disabled={!username||load}
            style={{width:"100%",background:!username?"#ffffff10":`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:18,padding:"16px",color:!username?"#ffffff30":"#fff",fontWeight:800,fontSize:15,cursor:!username?"default":"pointer",transition:"all 0.3s"}}>
            {load?<span style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><span style={{width:18,height:18,borderRadius:"50%",border:"2px solid #ffffff40",borderTopColor:"#fff",display:"inline-block",animation:"spin 0.8s linear infinite"}}/>Ø¬Ø§Ø±ÙŠ...</span>:"âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"}
          </button>
        </>)}
      </div>
    </div>
  );
}

function NotifPanel({ user, onClose }) {
  const [notifs,setNotifs]=useState([]); const [loading,setLoad]=useState(true);
  useEffect(()=>{
    if(!user?.uid)return;
    const unsub=db.collection("notifications").where("uid","==",user.uid).orderBy("createdAt","desc").limit(20).onSnapshot(s=>{setNotifs(s.docs.map(d=>({id:d.id,...d.data()})));setLoad(false);},()=>setLoad(false));
    return()=>unsub();
  },[user]);
  const markRead=async id=>{await db.collection("notifications").doc(id).update({read:true});};
  return (
    <div style={{position:"fixed",inset:0,background:"#000000AA",zIndex:500,backdropFilter:"blur(4px)"}} onClick={onClose}>
      <div onClick={e=>e.stopPropagation()} style={{position:"absolute",top:70,left:16,right:16,maxWidth:448,margin:"0 auto",background:CARD2,borderRadius:22,border:"1px solid #ffffff12",boxShadow:"0 20px 60px #000000AA",animation:"fadeDown 0.3s ease",maxHeight:"70vh",overflow:"hidden",display:"flex",flexDirection:"column"}}>
        <div style={{padding:"16px 20px",borderBottom:"1px solid #ffffff08",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{color:"#fff",fontWeight:700,fontSize:16}}>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
          <button onClick={onClose} style={{background:"none",border:"none",color:"#ffffff50",fontSize:20,cursor:"pointer"}}>âœ•</button>
        </div>
        <div style={{overflowY:"auto",flex:1}}>
          {loading?<div style={{textAlign:"center",padding:"30px"}}><div style={{width:30,height:30,borderRadius:"50%",border:`2px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite",margin:"0 auto"}}/></div>
          :notifs.length===0?<div style={{textAlign:"center",color:"#ffffff30",padding:"40px"}}><div style={{fontSize:40}}>ğŸ”•</div><div style={{marginTop:10}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div></div>
          :notifs.map((n)=>(
            <div key={n.id} onClick={()=>markRead(n.id)} style={{padding:"14px 20px",borderBottom:"1px solid #ffffff06",display:"flex",gap:12,alignItems:"flex-start",background:n.read?"transparent":`${ORANGE}08`,cursor:"pointer"}}>
              <div style={{width:40,height:40,borderRadius:12,background:n.read?"#ffffff08":`${ORANGE}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}}>{n.title?.split(" ")[0]||"ğŸ“¢"}</div>
              <div style={{flex:1}}>
                <div style={{color:n.read?"#ffffff80":"#fff",fontWeight:n.read?400:700,fontSize:14}}>{n.title}</div>
                <div style={{color:"#ffffff50",fontSize:12,marginTop:3}}>{n.body}</div>
                <div style={{color:"#ffffff30",fontSize:10,marginTop:4}}>{n.createdAt?.toDate?.()?.toLocaleString('ar')||""}</div>
              </div>
              {!n.read&&<div style={{width:8,height:8,borderRadius:"50%",background:ORANGE,flexShrink:0,marginTop:6,animation:"pulse 2s infinite"}}/>}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

function App() {
  const [splash,setSplash]=useState(true); const [user,setUser]=useState(null); const [authLoading,setAL]=useState(true);
  const [tab,setTab]=useState("home"); const [balance,setBalance]=useState(0); const [points,setPoints]=useState(0);
  const [buyItem,setBuyItem]=useState(null); const [toast,setToast]=useState(null);
  const [showNotif,setShowNotif]=useState(false); const [unreadCount,setUnreadCount]=useState(0);
  const isAdmin=user?.email===ADMIN_EMAIL;
  const showToast=msg=>{setToast(msg);setTimeout(()=>setToast(null),3500);};

  useEffect(()=>{
    const unsub=auth.onAuthStateChanged(async fbUser=>{
      if(fbUser){
        try{
          const snap=await db.collection("users").doc(fbUser.uid).get(); const data=snap.exists?snap.data():{};
          setUser({uid:fbUser.uid,name:data.name||fbUser.displayName||fbUser.email?.split("@")[0]||"Ù…Ø³ØªØ®Ø¯Ù…",email:fbUser.email||"",balance:data.balance||0,points:data.points||0});
          setBalance(data.balance||0);setPoints(data.points||0);
        }catch(e){setUser({uid:fbUser.uid,name:fbUser.displayName||fbUser.email?.split("@")[0]||"Ù…Ø³ØªØ®Ø¯Ù…",email:fbUser.email||"",balance:0,points:0});}
      }else setUser(null);
      setAL(false);
    });
    return()=>unsub();
  },[]);

  useEffect(()=>{
    if(!user?.uid)return;
    const unsub=db.collection("notifications").where("uid","==",user.uid).where("read","==",false).onSnapshot(s=>setUnreadCount(s.size),()=>{});
    return()=>unsub();
  },[user]);

  const handleLogin=ud=>{setUser(ud);setBalance(ud.balance||0);setPoints(ud.points||0);showToast(`ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ ${ud.name}!`);};
  const handleLogout=async()=>{await auth.signOut();setUser(null);setTab("home");showToast("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");};
  const handleConfirmBuy=()=>{setBuyItem(null);showToast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹");setTab("orders");};

  const navTabs=[
    {id:"home",icon:"ğŸ ",label:"Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"},
    {id:"services",icon:"ğŸ›’",label:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª"},
    {id:"orange",icon:"ğŸŸ ",label:"Orange"},
    {id:"orders",icon:"ğŸ“¦",label:"Ø·Ù„Ø¨Ø§ØªÙŠ"},
    {id:"support",icon:"ğŸ¤–",label:"Ø§Ù„Ø¯Ø¹Ù… AI"},
    {id:"profile",icon:"ğŸ‘¤",label:"Ø­Ø³Ø§Ø¨ÙŠ"},
  ];

  if(splash)return <Splash onDone={()=>setSplash(false)}/>;
  if(authLoading)return <div style={{minHeight:"100vh",background:BG,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:16}}><div style={{width:50,height:50,borderRadius:"50%",border:`3px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite"}}/><div style={{color:"#ffffff40",fontSize:14}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div></div>;
  if(!user)return(<><LoginScreen onLogin={handleLogin} showToast={showToast}/>{toast&&<div style={{position:"fixed",top:30,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,color:"#fff",borderRadius:18,padding:"13px 26px",fontWeight:700,fontSize:14,zIndex:9999,whiteSpace:"nowrap",animation:"toastIn 0.3s ease"}}>{toast}</div>}</>);

  return (
    <div style={{background:BG,minHeight:"100vh",maxWidth:480,margin:"0 auto",position:"relative",paddingBottom:90}}>
      <div style={{background:`${BG}F0`,backdropFilter:"blur(16px)",padding:"14px 18px 10px",position:"sticky",top:0,zIndex:100,borderBottom:"1px solid #ffffff08"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{fontWeight:900,fontSize:20,letterSpacing:3,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>âš¡ FAST STORE</div>
          <div style={{display:"flex",gap:8,alignItems:"center"}}>
            <div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:20,padding:"5px 12px",color:ORANGE,fontSize:13,fontWeight:700}}>ğŸŸ  <Counter value={balance}/> DH</div>
            <div onClick={()=>setShowNotif(!showNotif)} style={{width:36,height:36,borderRadius:10,background:CARD,border:`1px solid ${unreadCount>0?ORANGE+"50":"#ffffff0A"}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:18,position:"relative"}}>
              ğŸ””
              {unreadCount>0&&<div style={{position:"absolute",top:-4,left:-4,width:18,height:18,borderRadius:"50%",background:RED,color:"#fff",fontSize:10,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",animation:"notifPop 0.3s ease"}}>{unreadCount}</div>}
            </div>
            {isAdmin&&<div onClick={()=>setTab("admin")} style={{width:36,height:36,borderRadius:10,background:tab==="admin"?`${ORANGE}20`:CARD,border:`1px solid ${tab==="admin"?ORANGE+"40":"#ffffff0A"}`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:18}}>âš™ï¸</div>}
          </div>
        </div>
      </div>

      <div style={{paddingTop:14}}>
        {tab==="home"&&<HomeTab user={user} balance={balance} points={points} onBuy={setBuyItem} setTab={setTab}/>}
        {tab==="services"&&<ServicesTab onBuy={setBuyItem}/>}
        {tab==="orange"&&<OrangeTab user={user} balance={balance} setBalance={setBalance} showToast={showToast}/>}
        {tab==="orders"&&<OrdersTab user={user}/>}
        {tab==="support"&&<SupportTab user={user} showToast={showToast}/>}
        {tab==="profile"&&<ProfileTab user={user} balance={balance} points={points} setTab={setTab} onLogout={handleLogout} showToast={showToast}/>}
        {tab==="admin"&&isAdmin&&<AdminTab user={user} showToast={showToast}/>}
      </div>

      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:480,background:`${CARD2}F8`,backdropFilter:"blur(20px)",borderTop:"1px solid #ffffff0A",padding:"8px 4px 16px",zIndex:200}}>
        <div style={{display:"flex",justifyContent:"space-around"}}>
          {navTabs.map(t=>{
            const active=tab===t.id;
            return (
              <button key={t.id} onClick={()=>setTab(t.id)} style={{background:"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:3,padding:"0 2px"}}>
                <div style={{width:42,height:42,borderRadius:13,background:active?`${ORANGE}20`:"transparent",border:active?`1px solid ${ORANGE}40`:"1px solid transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:19,transition:"all 0.25s",boxShadow:active?`0 0 15px ${ORANGE}30`:"none",transform:active?"scale(1.1)":"scale(1)"}}>
                  {t.icon}
                </div>
                <div style={{fontSize:9,fontWeight:active?700:400,color:active?ORANGE:"#ffffff35",transition:"all 0.25s"}}>{t.label}</div>
              </button>
            );
          })}
        </div>
      </div>

      {showNotif&&<NotifPanel user={user} onClose={()=>setShowNotif(false)}/>}
      {buyItem&&<BuyModal item={buyItem} user={user} onClose={()=>setBuyItem(null)} onConfirm={handleConfirmBuy} showToast={showToast}/>}
      {toast&&<div style={{position:"fixed",top:78,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,color:"#fff",borderRadius:18,padding:"12px 24px",fontWeight:700,fontSize:14,zIndex:999,whiteSpace:"nowrap",boxShadow:`0 8px 30px ${ORANGE}40`,animation:"toastIn 0.3s ease"}}>{toast}</div>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
