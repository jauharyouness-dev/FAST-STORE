<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FAST STORE âš¡</title>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<!-- React -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#0A0A0F; font-family:'Segoe UI',Tahoma,sans-serif; direction:rtl; }
  ::-webkit-scrollbar { width:4px; }
  ::-webkit-scrollbar-track { background:#0A0A0F; }
  ::-webkit-scrollbar-thumb { background:#FF6B0040; border-radius:2px; }
  input,button { font-family:'Segoe UI',Tahoma,sans-serif; }
  input:focus { outline:none; }
  @keyframes spin     { to{transform:rotate(360deg)} }
  @keyframes fadeIn   { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
  @keyframes fadeDown { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
  @keyframes pulse    { 0%,100%{opacity:1} 50%{opacity:.5} }
  @keyframes glow     { 0%,100%{box-shadow:0 0 20px #FF6B0040} 50%{box-shadow:0 0 50px #FF6B0080} }
  @keyframes slideUp  { from{transform:translateY(100%)} to{transform:translateY(0)} }
  @keyframes toastIn  { from{opacity:0;transform:translateX(-50%) translateY(-20px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
  @keyframes float    { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-7px)} }
  @keyframes shake    { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
  @keyframes bgPulse  { 0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)} }
</style>
</head>
<body>
<div id="root"></div>

<script>
// ==================== FIREBASE INIT ====================
const firebaseConfig = {
  apiKey: "AIzaSyBKutzG178Fnp_3LIN1dXl_IEyDub1JCVw",
  authDomain: "fast-store-79d55.firebaseapp.com",
  projectId: "fast-store-79d55",
  storageBucket: "fast-store-79d55.firebasestorage.app",
  messagingSenderId: "938372337651",
  appId: "1:938372337651:web:1b832a670fae1d8c510c86"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

// ==================== TELEGRAM NOTIFY ====================
const TG_TOKEN   = "8390349160:AAGlePL2KGPU4nmtR7XackUOsyQY50XqAC0";
const TG_CHAT_ID = "8038053852";

async function sendTelegram(message) {
  try {
    await fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ chat_id: TG_CHAT_ID, text: message, parse_mode: "Markdown" })
    });
  } catch(e) { console.log("Telegram error:", e); }
}
</script>

<script type="text/babel">
const { useState, useEffect } = React;

const ORANGE  = "#FF6B00";
const ORANGE2 = "#FF9500";
const BLUE_FB = "#1877F2";
const BG      = "#0A0A0F";
const CARD    = "#12121A";
const CARD2   = "#1A1A2E";

const PLANS = [
  { dh:5,  balance:500,  popular:false },
  { dh:10, balance:1000, popular:true  },
  { dh:20, balance:2000, popular:false },
  { dh:50, balance:5000, popular:false },
];

const services = [
  { id:1, category:"PUBG Mobile", icon:"ğŸ®", items:[
    { id:11, name:"Ø­Ø³Ø§Ø¨ PUBG Gold",    price:150, desc:"Ø­Ø³Ø§Ø¨ Ø°Ù‡Ø¨ÙŠ Ù…Ø¹ Ø³ÙƒÙŠÙ†Ø§Øª Ù†Ø§Ø¯Ø±Ø©" },
    { id:12, name:"Ø­Ø³Ø§Ø¨ PUBG Diamond", price:350, desc:"Ø­Ø³Ø§Ø¨ Ø£Ù„Ù…Ø§Ø³ÙŠ + Ù…Ù„Ø§Ø¨Ø³ Ø­ØµØ±ÙŠØ©" },
    { id:13, name:"Ø´Ø­Ù† UC Ã— 60",       price:25,  desc:"60 UC Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø­Ø³Ø§Ø¨" },
    { id:14, name:"Ø´Ø­Ù† UC Ã— 325",      price:120, desc:"325 UC Ø¨Ø£ÙØ¶Ù„ Ø³Ø¹Ø±" },
  ]},
  { id:2, category:"Free Fire", icon:"ğŸ”¥", items:[
    { id:21, name:"Ø­Ø³Ø§Ø¨ FF Bronze",   price:80,  desc:"Ø­Ø³Ø§Ø¨ Ø¨Ø±ÙˆÙ†Ø²ÙŠ Ù…Ø¹ Ø´Ø®ØµÙŠØ§Øª" },
    { id:22, name:"Ø­Ø³Ø§Ø¨ FF Elite",    price:450, desc:"Ø­Ø³Ø§Ø¨ Ù†Ø®Ø¨Ø© + Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª" },
    { id:23, name:"Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Ã— 100", price:30,  desc:"100 Ø¬ÙˆÙ‡Ø±Ø© ÙØ±ÙŠ ÙØ§ÙŠØ±" },
    { id:24, name:"Ø´Ø­Ù† Ø¬ÙˆØ§Ù‡Ø± Ã— 520", price:140, desc:"520 Ø¬ÙˆÙ‡Ø±Ø© Ø¨Ø³Ø¹Ø± Ø®Ø§Øµ" },
  ]},
  { id:3, category:"Instagram", icon:"ğŸ“¸", items:[
    { id:31, name:"Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ã— 1000",        price:50, desc:"Ù…ØªØ§Ø¨Ø¹ÙŠÙ† Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ† ÙˆØ¢Ù…Ù†ÙŠÙ†" },
    { id:32, name:"Ù„Ø§ÙŠÙƒØ§Øª Ã— 500",          price:20, desc:"Ù„Ø§ÙŠÙƒØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ø£ÙŠ Ù…Ù†Ø´ÙˆØ±" },
    { id:33, name:"Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø³ØªÙˆØ±ÙŠ Ã— 1000", price:15, desc:"Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø³ØªÙˆØ±ÙŠ ÙÙˆØ±ÙŠØ©" },
    { id:34, name:"ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ã— 50",          price:35, desc:"ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©" },
  ]},
];

// ==================== COUNTER ====================
function Counter({ value }) {
  const [d, setD] = useState(0);
  useEffect(() => {
    let c = 0;
    const step = Math.max(1, Math.ceil(value / 50));
    const t = setInterval(() => {
      c += step;
      if (c >= value) { setD(value); clearInterval(t); }
      else setD(c);
    }, 25);
    return () => clearInterval(t);
  }, [value]);
  return d.toLocaleString('ar');
}

// ==================== SPLASH ====================
function Splash({ onDone }) {
  const [prog, setProg] = useState(0);
  useEffect(() => {
    const t = setInterval(() => setProg(p => {
      if (p >= 100) { clearInterval(t); setTimeout(onDone, 300); return 100; }
      return p + 2;
    }), 30);
    return () => clearInterval(t);
  }, []);
  return (
    <div style={{position:"fixed",inset:0,background:BG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999}}>
      {[...Array(4)].map((_,i)=>(
        <div key={i} style={{position:"absolute",width:130+i*100,height:130+i*100,borderRadius:"50%",border:`1px solid ${i%2===0?ORANGE:ORANGE2}12`,top:"50%",left:"50%",transform:"translate(-50%,-50%)",animation:`pulse ${2+i*0.4}s ease-in-out infinite`}}/>
      ))}
      <div style={{width:110,height:110,borderRadius:"50%",background:`conic-gradient(${ORANGE},${ORANGE2},${ORANGE})`,display:"flex",alignItems:"center",justifyContent:"center",animation:"spin 3s linear infinite",boxShadow:`0 0 50px ${ORANGE}60`,marginBottom:32}}>
        <div style={{width:90,height:90,borderRadius:"50%",background:BG,display:"flex",alignItems:"center",justifyContent:"center",fontSize:42}}>âš¡</div>
      </div>
      <div style={{fontSize:36,fontWeight:900,letterSpacing:5,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",animation:"float 3s ease-in-out infinite"}}>FAST STORE</div>
      <div style={{color:"#ffffff50",fontSize:14,marginTop:8,letterSpacing:3}}>Ù…ØªØ¬Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© #1</div>
      <div style={{width:240,marginTop:44}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
          <span style={{color:"#ffffff40",fontSize:12}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
          <span style={{color:ORANGE,fontSize:12,fontWeight:700}}>{prog}%</span>
        </div>
        <div style={{height:5,background:"#ffffff10",borderRadius:10,overflow:"hidden"}}>
          <div style={{height:"100%",borderRadius:10,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,width:`${prog}%`,transition:"width 0.1s"}}/>
        </div>
      </div>
    </div>
  );
}

// ==================== LOGIN ====================
function LoginScreen({ onLogin, showToast }) {
  const [mode, setMode]     = useState("login");
  const [email, setEmail]   = useState("");
  const [pass, setPass]     = useState("");
  const [name, setName]     = useState("");
  const [loading, setLoad]  = useState(false);
  const [showP, setShowP]   = useState(false);
  const [err, setErr]       = useState("");
  const [shake, setShake]   = useState(false);

  const doShake = () => { setShake(true); setTimeout(()=>setShake(false),500); };

  // âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: ÙØµÙ„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù† Ø­ÙØ¸ Firestore Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
  const handleEmail = async () => {
    setErr("");

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
    if (mode === "register") {
      if (!name.trim()) { setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"); doShake(); return; }
      if (!email.trim()) { setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"); doShake(); return; }
      if (!pass.trim()) { setErr("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"); doShake(); return; }
      if (pass.length < 6) { setErr("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); doShake(); return; }
    } else {
      if (!email.trim() || !pass.trim()) { setErr("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); doShake(); return; }
    }

    setLoad(true);

    try {
      if (mode === "register") {
        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
        let cred;
        try {
          cred = await auth.createUserWithEmailAndPassword(email.trim(), pass);
        } catch(authErr) {
          throw authErr;
        }

        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… (Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„)
        try {
          await cred.user.updateProfile({ displayName: name.trim() });
        } catch(profileErr) {
          console.log("Profile update failed (non-critical):", profileErr);
        }

        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø­ÙØ¸ ÙÙŠ Firestore (Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„)
        try {
          await db.collection("users").doc(cred.user.uid).set({
            name: name.trim(),
            email: email.trim(),
            balance: 0,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        } catch(dbErr) {
          console.log("Firestore save failed (non-critical):", dbErr);
        }

        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥Ø´Ø¹Ø§Ø± Telegram (Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¥Ø°Ø§ ÙØ´Ù„)
        try {
          await sendTelegram(`ğŸ‘¤ *Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯!*\nâ”â”â”â”â”â”â”â”â”â”â”â”\nğŸ™ Ø§Ù„Ø§Ø³Ù…: ${name.trim()}\nâœ‰ï¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${email.trim()}\nâ° ${new Date().toLocaleString('ar')}`);
        } catch(tgErr) {
          console.log("Telegram notification failed (non-critical):", tgErr);
        }

        // âœ… Ø§Ù„Ø®Ø·ÙˆØ© 5: ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­
        onLogin({ uid: cred.user.uid, name: name.trim(), email: email.trim(), balance: 0 });

      } else {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const cred = await auth.signInWithEmailAndPassword(email.trim(), pass);

        let userData = { name: cred.user.displayName || email.split("@")[0], balance: 0 };
        try {
          const snap = await db.collection("users").doc(cred.user.uid).get();
          if (snap.exists) {
            userData = snap.data();
          }
        } catch(dbErr) {
          console.log("Firestore read failed (non-critical):", dbErr);
        }

        onLogin({
          uid: cred.user.uid,
          name: userData.name || cred.user.displayName || email.split("@")[0],
          email: email.trim(),
          balance: userData.balance || 0
        });
      }
    } catch(e) {
      console.log("Auth error:", e.code, e.message);
      const msgs = {
        "auth/email-already-in-use": "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ù‚Ø¨Ù„",
        "auth/wrong-password": "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
        "auth/user-not-found": "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",
        "auth/weak-password": "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)",
        "auth/invalid-email": "ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
        "auth/invalid-credential": "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
        "auth/too-many-requests": "Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹",
        "auth/network-request-failed": "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª",
        "auth/operation-not-allowed": "Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø©ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…",
      };
      setErr(msgs[e.code] || `Ø­Ø¯Ø« Ø®Ø·Ø£: ${e.message || "Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹"}`);
      doShake();
    }

    setLoad(false);
  };

  const handleForgot = async () => {
    if (!email.trim()) { setErr("Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹"); doShake(); return; }
    setLoad(true);
    try {
      await auth.sendPasswordResetEmail(email.trim());
      showToast("ğŸ“§ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ!");
      setMode("login");
    } catch(e) {
      const msgs = {
        "auth/user-not-found": "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯",
        "auth/invalid-email": "ØµÙŠØºØ© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
      };
      setErr(msgs[e.code] || "Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹");
      doShake();
    }
    setLoad(false);
  };

  return (
    <div style={{minHeight:"100vh",background:BG,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"20px 24px",position:"relative",overflow:"hidden"}}>
      <div style={{position:"absolute",top:-100,right:-80,width:280,height:280,borderRadius:"50%",background:`${ORANGE}08`,filter:"blur(60px)",animation:"bgPulse 8s ease-in-out infinite"}}/>
      <div style={{position:"absolute",bottom:-80,left:-60,width:220,height:220,borderRadius:"50%",background:`${ORANGE2}06`,filter:"blur(50px)",animation:"bgPulse 10s ease-in-out infinite reverse"}}/>

      {/* Ø´Ø¹Ø§Ø± */}
      <div style={{textAlign:"center",marginBottom:32,animation:"fadeDown 0.6s ease"}}>
        <div style={{width:80,height:80,borderRadius:24,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:36,margin:"0 auto 14px",boxShadow:`0 0 30px ${ORANGE}50`,animation:"glow 3s ease-in-out infinite"}}>âš¡</div>
        <div style={{fontSize:26,fontWeight:900,letterSpacing:4,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>FAST STORE</div>
        <div style={{color:"#ffffff40",fontSize:13,marginTop:6}}>
          {mode==="login"?"Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ğŸ‘‹":mode==="register"?"Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù† ğŸš€":"Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ”‘"}
        </div>
      </div>

      {/* Ø¨Ø·Ø§Ù‚Ø© */}
      <div style={{width:"100%",maxWidth:400,background:CARD2,borderRadius:24,padding:26,border:`1px solid #ffffff0A`,boxShadow:`0 20px 60px #00000060`,animation:"fadeIn 0.5s ease"}}>

        {/* Facebook */}
        {mode !== "forgot" && (
          <>
            <button style={{width:"100%",background:BLUE_FB,border:"none",borderRadius:14,padding:"14px",color:"#fff",fontWeight:700,fontSize:15,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:10,boxShadow:`0 4px 20px ${BLUE_FB}40`,marginBottom:16}}>
              <svg width="22" height="22" viewBox="0 0 24 24" fill="white">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
              Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Facebook
            </button>
            <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:16}}>
              <div style={{flex:1,height:1,background:"#ffffff12"}}/>
              <span style={{color:"#ffffff30",fontSize:12}}>Ø£Ùˆ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
              <div style={{flex:1,height:1,background:"#ffffff12"}}/>
            </div>
          </>
        )}

        {/* Ø®Ø·Ø£ */}
        {err && (
          <div style={{background:"#EF444415",border:"1px solid #EF444430",borderRadius:12,padding:"10px 14px",marginBottom:14,color:"#EF4444",fontSize:13,textAlign:"center",animation:"fadeIn 0.3s ease"}}>
            âŒ {err}
          </div>
        )}

        {/* Ø§Ù„Ø§Ø³Ù… */}
        {mode==="register" && (
          <div style={{marginBottom:14}}>
            <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</div>
            <div style={{position:"relative"}}>
              <span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>ğŸ‘¤</span>
              <input value={name} onChange={e=>setName(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"
                style={{width:"100%",background:"#ffffff08",border:`1px solid ${name?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px 13px 14px",color:"#fff",fontSize:14,boxSizing:"border-box",transition:"border-color 0.2s"}}/>
            </div>
          </div>
        )}

        {/* Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ */}
        <div style={{marginBottom:14}}>
          <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
          <div style={{position:"relative"}}>
            <span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>âœ‰ï¸</span>
            <input value={email} onChange={e=>{setEmail(e.target.value);setErr("");}} placeholder="example@email.com" type="email"
              style={{width:"100%",background:"#ffffff08",border:`1px solid ${email?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px 13px 14px",color:"#fff",fontSize:14,boxSizing:"border-box",transition:"border-color 0.2s",animation:shake?"shake 0.4s ease":"none"}}/>
          </div>
        </div>

        {/* ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */}
        {mode !== "forgot" && (
          <div style={{marginBottom:18}}>
            <div style={{color:"#ffffff60",fontSize:12,marginBottom:6}}>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
            <div style={{position:"relative"}}>
              <span style={{position:"absolute",right:14,top:"50%",transform:"translateY(-50%)",fontSize:18}}>ğŸ”’</span>
              <input value={pass} onChange={e=>{setPass(e.target.value);setErr("");}} placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" type={showP?"text":"password"}
                style={{width:"100%",background:"#ffffff08",border:`1px solid ${pass?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"13px 44px",color:"#fff",fontSize:14,boxSizing:"border-box",transition:"border-color 0.2s"}}/>
              <span onClick={()=>setShowP(!showP)} style={{position:"absolute",left:14,top:"50%",transform:"translateY(-50%)",fontSize:16,cursor:"pointer",opacity:0.5}}>{showP?"ğŸ™ˆ":"ğŸ‘ï¸"}</span>
            </div>
            {mode==="login" && (
              <div onClick={()=>{setMode("forgot");setErr("");}} style={{color:ORANGE,fontSize:12,marginTop:8,cursor:"pointer",textAlign:"left"}}>Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</div>
            )}
            {/* âœ… Ù…Ø¤Ø´Ø± Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ØªØ³Ø¬ÙŠÙ„ */}
            {mode==="register" && pass.length > 0 && (
              <div style={{marginTop:8}}>
                <div style={{display:"flex",gap:4}}>
                  {[1,2,3,4].map(i=>(
                    <div key={i} style={{flex:1,height:3,borderRadius:2,background:
                      pass.length >= i*2 ? (pass.length>=8?"#22C55E":pass.length>=6?ORANGE:"#EF4444") : "#ffffff15",
                      transition:"background 0.3s"}}/>
                  ))}
                </div>
                <div style={{color:pass.length>=8?"#22C55E":pass.length>=6?ORANGE:"#EF4444",fontSize:11,marginTop:4}}>
                  {pass.length>=8?"Ù‚ÙˆÙŠØ© âœ…":pass.length>=6?"Ù…Ù‚Ø¨ÙˆÙ„Ø© âš ï¸":"Ø¶Ø¹ÙŠÙØ© âŒ"} ({pass.length} Ø£Ø­Ø±Ù)
                </div>
              </div>
            )}
          </div>
        )}

        {/* forgot info */}
        {mode==="forgot" && (
          <div style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}25`,borderRadius:12,padding:14,marginBottom:18}}>
            <div style={{color:ORANGE,fontSize:13}}>ğŸ“§ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
          </div>
        )}

        {/* Ø²Ø± Ø±Ø¦ÙŠØ³ÙŠ */}
        <button onClick={mode==="forgot"?handleForgot:handleEmail} disabled={loading} style={{
          width:"100%",background:loading?"#ffffff20":`linear-gradient(135deg,${ORANGE},${ORANGE2})`,
          border:"none",borderRadius:14,padding:"15px",color:"#fff",fontWeight:800,fontSize:16,
          cursor:loading?"not-allowed":"pointer",boxShadow:loading?"none":`0 6px 20px ${ORANGE}40`,
          transition:"all 0.3s"
        }}>
          {loading ? (
            <span style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
              <span style={{width:18,height:18,borderRadius:"50%",border:"2px solid #ffffff40",borderTopColor:"#fff",display:"inline-block",animation:"spin 0.8s linear infinite"}}/>
              Ø¬Ø§Ø±ÙŠ...
            </span>
          ) : mode==="login"?"ğŸš€ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":mode==="register"?"âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨":"ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·"}
        </button>

        {/* ØªØ¨Ø¯ÙŠÙ„ */}
        <div style={{textAlign:"center",marginTop:18}}>
          {mode==="login" && <span style={{color:"#ffffff50",fontSize:13}}>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onClick={()=>{setMode("register");setErr("");setEmail("");setPass("");setName("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer"}}>Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹</span></span>}
          {mode==="register" && <span style={{color:"#ffffff50",fontSize:13}}>Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onClick={()=>{setMode("login");setErr("");setEmail("");setPass("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer"}}>Ø³Ø¬Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span></span>}
          {mode==="forgot" && <span onClick={()=>{setMode("login");setErr("");}} style={{color:ORANGE,fontWeight:700,cursor:"pointer",fontSize:13}}>â†’ Ø±Ø¬ÙˆØ¹ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>}
        </div>
      </div>

      <div style={{color:"#ffffff20",fontSize:11,marginTop:20,textAlign:"center"}}>
        Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ‚Ø¨Ù„ <span style={{color:"#ffffff35",textDecoration:"underline",cursor:"pointer"}}>Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</span>
      </div>
    </div>
  );
}

// ==================== HOME TAB ====================
function HomeTab({ user, balance, onBuy, setTab }) {
  const featured = [services[0].items[0], services[1].items[2], services[2].items[0]];
  const [timeLeft, setTimeLeft] = useState(82800);
  useEffect(() => { const t = setInterval(()=>setTimeLeft(s=>s>0?s-1:0),1000); return()=>clearInterval(t); },[]);
  const fmt = s=>`${String(Math.floor(s/3600)).padStart(2,"0")}:${String(Math.floor((s%3600)/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{background:`linear-gradient(135deg,#1A1200,#2A1A00)`,border:`1px solid ${ORANGE}30`,borderRadius:22,padding:24,marginBottom:16,position:"relative",overflow:"hidden"}}>
        <div style={{position:"absolute",top:-40,right:-40,width:160,height:160,borderRadius:"50%",background:`${ORANGE}10`,filter:"blur(40px)"}}/>
        <div style={{color:"#ffffff50",fontSize:12,marginBottom:4}}>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ØŒ {user.name}</div>
        <div style={{color:"#ffffff50",fontSize:12,marginBottom:6}}>ğŸ’³ Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
        <div style={{fontSize:38,fontWeight:900,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",lineHeight:1.2}}>
          <Counter value={balance}/> <span style={{fontSize:18,WebkitTextFillColor:"#ffffff50"}}>DH</span>
        </div>
        <div style={{display:"flex",gap:16,marginTop:16}}>
          <button onClick={()=>setTab("orange")} style={{background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:12,padding:"10px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:13,boxShadow:`0 4px 15px ${ORANGE}40`}}>
            ğŸŸ  Ø´Ø­Ù† Orange
          </button>
        </div>
      </div>

      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16}}>
        {[{l:"Ø§Ù„Ø·Ù„Ø¨Ø§Øª",v:3,icon:"ğŸ“¦",c:ORANGE},{l:"Ù…ÙƒØªÙ…Ù„Ø©",v:1,icon:"âœ…",c:"#22C55E"},{l:"Ù…Ù„ØºÙŠØ©",v:1,icon:"âŒ",c:"#EF4444"}].map((s,i)=>(
          <div key={i} style={{background:CARD,borderRadius:16,padding:"16px 10px",textAlign:"center",border:`1px solid #ffffff0A`}}>
            <div style={{fontSize:24}}>{s.icon}</div>
            <div style={{color:s.c,fontWeight:900,fontSize:22,marginTop:4}}>{s.v}</div>
            <div style={{color:"#ffffff40",fontSize:10,marginTop:2}}>{s.l}</div>
          </div>
        ))}
      </div>

      <div onClick={()=>setTab("orange")} style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:18,marginBottom:16,cursor:"pointer",display:"flex",alignItems:"center",gap:16}}>
        <div style={{fontSize:44}}>ğŸŸ </div>
        <div style={{flex:1}}>
          <div style={{color:ORANGE,fontWeight:800,fontSize:16}}>Ø´Ø­Ù† Ø±ØµÙŠØ¯ Ø¨Ù€ Orange Money</div>
          <div style={{color:"#ffffff60",fontSize:13,marginTop:4}}>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ ÙÙˆØ±Ø§Ù‹</div>
        </div>
        <div style={{color:ORANGE,fontSize:24}}>â€¹</div>
      </div>

      <div style={{color:"#fff",fontWeight:700,fontSize:16,marginBottom:12}}>ğŸ”¥ Ø®Ø¯Ù…Ø§Øª Ù…Ù…ÙŠØ²Ø©</div>
      {featured.map((item,i)=>(
        <div key={item.id} style={{background:CARD,borderRadius:18,padding:16,marginBottom:10,border:`1px solid #ffffff0A`,display:"flex",alignItems:"center",gap:14,animation:`fadeIn 0.4s ease ${i*0.1}s both`}}>
          <div style={{width:52,height:52,borderRadius:14,fontSize:26,background:`${ORANGE}10`,display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${ORANGE}20`,flexShrink:0}}>
            {services.find(s=>s.items.some(it=>it.id===item.id))?.icon}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <div style={{color:"#fff",fontWeight:600,fontSize:14,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{item.name}</div>
            <div style={{color:"#ffffff50",fontSize:12,marginTop:2}}>{item.desc}</div>
          </div>
          <button onClick={()=>onBuy(item)} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:12,padding:"9px 16px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:13,whiteSpace:"nowrap",flexShrink:0}}>{item.price} DH</button>
        </div>
      ))}

      <div style={{background:`${ORANGE}10`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:18}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div>
            <div style={{color:ORANGE,fontWeight:800,fontSize:15}}>ğŸ‰ Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…!</div>
            <div style={{color:"#fff",fontSize:13,marginTop:6,lineHeight:1.6}}>Ø§Ø´Ø­Ù† 50 DH ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰<br/><span style={{color:ORANGE2,fontWeight:700}}>5 DH Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†Ø§Ù‹</span></div>
          </div>
          <div style={{textAlign:"center"}}>
            <div style={{color:"#ffffff50",fontSize:11}}>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</div>
            <div style={{color:ORANGE,fontWeight:900,fontSize:22}}>{fmt(timeLeft)}</div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ==================== SERVICES TAB ====================
function ServicesTab({ onBuy }) {
  const [sel, setSel] = useState(0);
  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{color:"#fff",fontWeight:700,fontSize:18,marginBottom:14}}>ğŸ›’ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
      <div style={{display:"flex",gap:8,marginBottom:16,overflowX:"auto",paddingBottom:4}}>
        {services.map((s,i)=>(
          <button key={s.id} onClick={()=>setSel(i)} style={{background:sel===i?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:CARD,border:sel===i?"none":`1px solid #ffffff12`,borderRadius:22,padding:"9px 18px",color:"#fff",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap",fontSize:13}}>{s.icon} {s.category}</button>
        ))}
      </div>
      {services[sel].items.map((item,i)=>(
        <div key={item.id} style={{background:CARD,borderRadius:18,padding:18,marginBottom:10,border:`1px solid #ffffff0A`,animation:`fadeIn 0.3s ease ${i*0.08}s both`}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12}}>
            <div style={{flex:1}}>
              <div style={{color:"#fff",fontWeight:700,fontSize:15}}>{item.name}</div>
              <div style={{color:"#ffffff50",fontSize:12,marginTop:4}}>{item.desc}</div>
              <div style={{marginTop:10}}>
                <span style={{background:`${ORANGE}15`,color:ORANGE,borderRadius:10,padding:"5px 14px",fontSize:13,fontWeight:700,border:`1px solid ${ORANGE}25`}}>{item.price} DH</span>
              </div>
            </div>
            <button onClick={()=>onBuy(item)} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 22px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14,flexShrink:0}}>Ø´Ø±Ø§Ø¡</button>
          </div>
        </div>
      ))}
    </div>
  );
}

// ==================== ORANGE TAB ====================
function OrangeTab({ user, balance, setBalance }) {
  const [step, setStep]   = useState(1);
  const [plan, setPlan]   = useState(null);
  const [code, setCode]   = useState("");
  const [err, setErr]     = useState("");
  const [shake, setShake] = useState(false);

  const fmtCode = v => {
    const d = v.replace(/\D/g,"").slice(0,14);
    return [d.slice(0,4),d.slice(4,8),d.slice(8,12),d.slice(12,14)].filter(Boolean).join(" ");
  };
  const reset = () => { setStep(1); setPlan(null); setCode(""); setErr(""); };

  const handleSubmit = async () => {
    const raw = code.replace(/\s/g,"");
    if (raw.length !== 14) { setErr("âŒ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 14 Ø±Ù‚Ù…"); setShake(true); setTimeout(()=>setShake(false),500); return; }
    setStep(3);
    try {
      const newBalance = balance + plan.dh;
      await db.collection("users").doc(user.uid).update({ balance: newBalance });
      await db.collection("recharges").add({
        uid: user.uid, name: user.name, email: user.email,
        code: raw, plan_dh: plan.dh, balance_added: plan.balance,
        status: "pending", createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      await sendTelegram(`ğŸŸ  *ÙƒÙˆØ¯ Orange Ø¬Ø¯ÙŠØ¯!*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${user.name}\nâœ‰ï¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${user.email}\nğŸ”¢ Ø§Ù„ÙƒÙˆØ¯: \`${raw}\`\nğŸ’° Ø§Ù„Ù‚ÙŠÙ…Ø©: ${plan.dh} DH\nâ° ${new Date().toLocaleString('ar-MA')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâœ… Ø£Ø±Ø³Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø¢Ù†!`);
      setBalance(newBalance);
      setStep(4);
    } catch(e) {
      setErr("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹");
      setStep(5);
    }
  };

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{color:"#fff",fontWeight:700,fontSize:18,marginBottom:4}}>ğŸŸ  Ø´Ø­Ù† Orange Money</div>
      <div style={{color:"#ffffff50",fontSize:13,marginBottom:20}}>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ ÙÙˆØ±Ø§Ù‹</div>

      <div style={{background:`linear-gradient(135deg,#1A1200,#2A1A00)`,border:`1px solid ${ORANGE}30`,borderRadius:18,padding:18,marginBottom:20,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div>
          <div style={{color:"#ffffff50",fontSize:12}}>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
          <div style={{fontSize:28,fontWeight:900,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginTop:4}}><Counter value={balance}/> <span style={{fontSize:16,WebkitTextFillColor:"#ffffff50"}}>DH</span></div>
        </div>
        <div style={{fontSize:48}}>ğŸ’°</div>
      </div>

      {step===1 && (
        <>
          <div style={{color:"#ffffff80",fontWeight:600,fontSize:14,marginBottom:12}}>Ø§Ø®ØªØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:20}}>
            {PLANS.map(p=>(
              <div key={p.dh} onClick={()=>{setPlan(p);setStep(2);}} style={{background:p.popular?`${ORANGE}15`:CARD,border:`2px solid ${p.popular?ORANGE+"60":"#ffffff12"}`,borderRadius:18,padding:20,cursor:"pointer",textAlign:"center",position:"relative"}}>
                {p.popular && <div style={{position:"absolute",top:-12,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,color:"#fff",fontSize:10,fontWeight:700,borderRadius:10,padding:"3px 12px",whiteSpace:"nowrap"}}>â­ Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹</div>}
                <div style={{color:p.popular?ORANGE:"#fff",fontWeight:900,fontSize:28,marginTop:p.popular?8:0}}>{p.dh}</div>
                <div style={{color:p.popular?ORANGE2:"#ffffff60",fontSize:14}}>Ø¯Ø±Ù‡Ù…</div>
                <div style={{color:"#ffffff40",fontSize:11,marginTop:6}}>= {p.balance} Ø¯Ø¬</div>
              </div>
            ))}
          </div>
          <div style={{background:`${ORANGE}08`,border:`1px solid ${ORANGE}20`,borderRadius:16,padding:16}}>
            <div style={{color:ORANGE,fontWeight:700,fontSize:13,marginBottom:10}}>ğŸ“‹ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ØŸ</div>
            {["Ø§Ø´ØªØ±Ù Ø¨Ø·Ø§Ù‚Ø© Orange Ù…Ù† Ø£ÙŠ Ù…Ø­Ù„","Ø§Ø®ØªØ± Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©","Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 14 Ø±Ù‚Ù…","ÙŠÙØ¶Ø§Ù Ø±ØµÙŠØ¯Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…"].map((s,i)=>(
              <div key={i} style={{display:"flex",gap:10,alignItems:"center",marginBottom:8}}>
                <div style={{width:22,height:22,borderRadius:"50%",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:700,color:"#fff",flexShrink:0}}>{i+1}</div>
                <div style={{color:"#ffffff60",fontSize:13}}>{s}</div>
              </div>
            ))}
          </div>
        </>
      )}

      {step===2 && (
        <>
          <button onClick={()=>setStep(1)} style={{background:"#ffffff10",border:"none",borderRadius:12,padding:"8px 16px",color:"#fff",cursor:"pointer",fontSize:13,marginBottom:20}}>â†’ Ø±Ø¬ÙˆØ¹</button>
          <div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:16,padding:16,marginBottom:20,display:"flex",justifyContent:"space-between"}}>
            <div><div style={{color:"#ffffff60",fontSize:12}}>Ø§Ù„Ø¨Ø§Ù‚Ø©</div><div style={{color:ORANGE,fontWeight:900,fontSize:26}}>{plan.dh} DH</div></div>
            <div style={{textAlign:"right"}}><div style={{color:"#ffffff40",fontSize:12}}>ÙŠØ¶Ø§Ù</div><div style={{color:ORANGE2,fontWeight:700,fontSize:18}}>{plan.balance} Ø¯Ø¬</div></div>
          </div>
          <div style={{marginBottom:8}}>
            <div style={{color:"#ffffff60",fontSize:13,marginBottom:10}}>ğŸ”¢ Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</div>
            <input value={code} onChange={e=>{setCode(fmtCode(e.target.value));setErr("");}} placeholder="XXXX  XXXX  XXXX  XX" maxLength={17}
              style={{width:"100%",background:"#ffffff08",border:`2px solid ${err?"#EF4444":code.replace(/\s/g,"").length===14?ORANGE:"#ffffff15"}`,borderRadius:16,padding:"18px",color:"#fff",fontSize:24,outline:"none",boxSizing:"border-box",textAlign:"center",letterSpacing:6,fontWeight:700,animation:shake?"shake 0.4s ease":"none"}}/>
            {err?<div style={{color:"#EF4444",fontSize:12,marginTop:8,textAlign:"center"}}>{err}</div>:<div style={{color:"#ffffff25",fontSize:12,marginTop:8,textAlign:"center"}}>ğŸ”’ ÙƒÙˆØ¯Ùƒ ÙŠÙØ±Ø³Ù„ Ø¨Ø£Ù…Ø§Ù†</div>}
          </div>
          <div style={{display:"flex",justifyContent:"center",gap:4,marginBottom:20}}>
            {[...Array(14)].map((_,i)=>(
              <div key={i} style={{width:16,height:4,borderRadius:2,background:i<code.replace(/\s/g,"").length?ORANGE:"#ffffff15",transition:"background 0.15s"}}/>
            ))}
          </div>
          <button onClick={handleSubmit} style={{width:"100%",background:code.replace(/\s/g,"").length===14?`linear-gradient(135deg,${ORANGE},${ORANGE2})`:"#ffffff10",border:"none",borderRadius:18,padding:"18px",color:code.replace(/\s/g,"").length===14?"#fff":"#ffffff30",fontWeight:800,fontSize:17,cursor:code.replace(/\s/g,"").length===14?"pointer":"default",transition:"all 0.3s"}}>
            âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
          </button>
        </>
      )}

      {step===3 && (
        <div style={{textAlign:"center",padding:"50px 0"}}>
          <div style={{width:80,height:80,borderRadius:"50%",background:`conic-gradient(${ORANGE},transparent)`,margin:"0 auto 24px",animation:"spin 1s linear infinite",display:"flex",alignItems:"center",justifyContent:"center"}}>
            <div style={{width:62,height:62,borderRadius:"50%",background:BG,display:"flex",alignItems:"center",justifyContent:"center",fontSize:30}}>ğŸŸ </div>
          </div>
          <div style={{color:"#fff",fontWeight:700,fontSize:20}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
          <div style={{display:"flex",gap:8,justifyContent:"center",marginTop:24}}>
            {[0,1,2].map(i=>(<div key={i} style={{width:10,height:10,borderRadius:"50%",background:ORANGE,animation:`pulse 1s ease-in-out ${i*0.2}s infinite`}}/>))}
          </div>
        </div>
      )}

      {step===4 && (
        <div style={{textAlign:"center",padding:"40px 0"}}>
          <div style={{fontSize:80,animation:"float 1s ease"}}>âœ…</div>
          <div style={{color:"#22C55E",fontWeight:800,fontSize:24,marginTop:16}}>ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­!</div>
          <div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:16,padding:16,marginTop:20}}>
            <div style={{color:ORANGE,fontWeight:900,fontSize:32}}>{plan?.dh} DH</div>
            <div style={{color:"#ffffff50",fontSize:13,marginTop:4}}>= {plan?.balance} Ø¯Ø¬ Ø£Ø¶ÙŠÙØª Ù„Ø±ØµÙŠØ¯Ùƒ</div>
          </div>
          <button onClick={reset} style={{marginTop:24,background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 40px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:15}}>Ø´Ø­Ù† Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
        </div>
      )}

      {step===5 && (
        <div style={{textAlign:"center",padding:"40px 0"}}>
          <div style={{fontSize:70}}>âŒ</div>
          <div style={{color:"#EF4444",fontWeight:800,fontSize:20,marginTop:16}}>ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚</div>
          <div style={{color:"#ffffff50",fontSize:14,marginTop:8}}>{err}</div>
          <div style={{display:"flex",gap:10,justifyContent:"center",marginTop:24}}>
            <button onClick={()=>{setStep(2);setErr("");}} style={{background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:14,padding:"12px 28px",color:"#fff",fontWeight:700,cursor:"pointer"}}>Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
            <button onClick={reset} style={{background:"#ffffff10",border:"none",borderRadius:14,padding:"12px 28px",color:"#fff",fontWeight:700,cursor:"pointer"}}>ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ù‚Ø©</button>
          </div>
        </div>
      )}
    </div>
  );
}

// ==================== ORDERS TAB ====================
function OrdersTab({ user }) {
  const [orders, setOrders] = useState([]);
  const [loading, setLoad]  = useState(true);

  useEffect(() => {
    if (!user?.uid) return;
    const unsub = db.collection("orders").where("uid","==",user.uid)
      .orderBy("createdAt","desc").onSnapshot(snap => {
        setOrders(snap.docs.map(d=>({id:d.id,...d.data()})));
        setLoad(false);
      }, () => setLoad(false));
    return () => unsub();
  }, [user]);

  const SC = {completed:"#22C55E",pending:ORANGE,cancelled:"#EF4444"};
  const SL = {completed:"Ù…ÙƒØªÙ…Ù„ âœ…",pending:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° â³",cancelled:"Ù…Ù„ØºÙŠ âŒ"};

  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
        <div style={{color:"#fff",fontWeight:700,fontSize:18}}>ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</div>
        <div style={{background:`${ORANGE}15`,color:ORANGE,borderRadius:10,padding:"4px 14px",fontSize:12,fontWeight:700}}>{orders.length} Ø·Ù„Ø¨</div>
      </div>
      {loading ? (
        <div style={{textAlign:"center",padding:"60px 0"}}>
          <div style={{width:40,height:40,borderRadius:"50%",border:`3px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite",margin:"0 auto"}}/>
          <div style={{color:"#ffffff40",marginTop:16}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
      ) : orders.length===0 ? (
        <div style={{textAlign:"center",color:"#ffffff30",padding:"80px 0"}}>
          <div style={{fontSize:60}}>ğŸ“­</div>
          <div style={{marginTop:16,fontSize:16}}>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>
          <div style={{fontSize:13,marginTop:8}}>Ø§Ø¨Ø¯Ø£ Ø¨Ø·Ù„Ø¨ Ø£ÙˆÙ„ Ø®Ø¯Ù…Ø©!</div>
        </div>
      ) : orders.map((o,i)=>(
        <div key={o.id} style={{background:CARD,borderRadius:18,padding:18,marginBottom:10,border:`1px solid #ffffff0A`,animation:`fadeIn 0.3s ease ${i*0.1}s both`}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
            <div style={{flex:1}}>
              <div style={{color:ORANGE,fontWeight:700,fontSize:11,marginBottom:4}}>#{o.id.slice(0,8).toUpperCase()}</div>
              <div style={{color:"#fff",fontWeight:600,fontSize:15}}>{o.service}</div>
              <div style={{color:"#ffffff40",fontSize:12,marginTop:4}}>ğŸ‘¤ {o.username}</div>
              <div style={{color:"#ffffff30",fontSize:11,marginTop:2}}>ğŸ“… {o.createdAt?.toDate?.()?.toLocaleDateString('ar') || "Ø§Ù„Ø¢Ù†"}</div>
            </div>
            <div style={{textAlign:"right",flexShrink:0,marginRight:8}}>
              <div style={{background:`${SC[o.status]||ORANGE}15`,color:SC[o.status]||ORANGE,borderRadius:10,padding:"5px 12px",fontSize:11,fontWeight:700}}>{SL[o.status]||"â³"}</div>
              <div style={{color:"#ffffff60",fontSize:14,marginTop:8,fontWeight:700}}>{o.price} DH</div>
            </div>
          </div>
          {o.status==="pending" && (
            <div style={{marginTop:14}}>
              <div style={{height:4,background:"#ffffff0A",borderRadius:4,overflow:"hidden"}}>
                <div style={{width:"60%",height:"100%",background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,borderRadius:4,animation:"pulse 1.5s ease-in-out infinite"}}/>
              </div>
            </div>
          )}
        </div>
      ))}
    </div>
  );
}

// ==================== PROFILE TAB ====================
function ProfileTab({ user, balance, setTab, onLogout }) {
  const menu = [
    {icon:"ğŸŸ ",l:"Ø´Ø­Ù† Orange Money",d:"ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯Ùƒ Ø¨ÙƒÙˆØ¯ Orange",action:()=>setTab("orange"),highlight:true},
    {icon:"ğŸ””",l:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",d:"Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"},
    {icon:"ğŸ›¡ï¸",l:"Ø§Ù„Ø£Ù…Ø§Ù†",d:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©"},
    {icon:"ğŸ’¬",l:"Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",d:"ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… 24/7"},
    {icon:"ğŸ“‹",l:"Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø³ÙŠØ§Ø³Ø©",d:"Ø§Ù‚Ø±Ø£ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©"},
    {icon:"ğŸšª",l:"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬",d:"Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨",danger:true,action:onLogout},
  ];
  return (
    <div style={{padding:"0 16px 16px",animation:"fadeIn 0.4s ease"}}>
      <div style={{textAlign:"center",padding:"24px 0 28px"}}>
        <div style={{width:90,height:90,borderRadius:"50%",margin:"0 auto 14px",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:40,boxShadow:`0 0 30px ${ORANGE}50`,animation:"glow 3s ease-in-out infinite"}}>ğŸ‘¤</div>
        <div style={{color:"#fff",fontWeight:800,fontSize:20}}>{user.name}</div>
        <div style={{color:"#ffffff50",fontSize:13,marginTop:4}}>{user.email}</div>
        <div style={{display:"inline-flex",gap:0,marginTop:20,background:CARD,borderRadius:18,padding:"16px 30px",border:`1px solid #ffffff0A`}}>
          <div style={{textAlign:"center",paddingLeft:20,borderLeft:`1px solid #ffffff10`}}>
            <div style={{color:ORANGE,fontWeight:900,fontSize:20}}><Counter value={balance}/></div>
            <div style={{color:"#ffffff40",fontSize:11,marginTop:3}}>Ø±ØµÙŠØ¯ (DH)</div>
          </div>
          <div style={{textAlign:"center",padding:"0 20px"}}>
            <div style={{color:"#22C55E",fontWeight:900,fontSize:20}}>ğŸ†</div>
            <div style={{color:"#ffffff40",fontSize:11,marginTop:3}}>Ø°Ù‡Ø¨ÙŠ</div>
          </div>
        </div>
      </div>
      {menu.map((m,i)=>(
        <div key={i} onClick={m.action||undefined} style={{background:m.highlight?`${ORANGE}10`:CARD,borderRadius:16,padding:"15px 16px",marginBottom:8,border:`1px solid ${m.danger?"#EF444420":m.highlight?ORANGE+"30":"#ffffff08"}`,display:"flex",alignItems:"center",gap:14,cursor:"pointer",animation:`fadeIn 0.3s ease ${i*0.06}s both`}}>
          <div style={{width:44,height:44,borderRadius:12,fontSize:22,background:m.danger?"#EF444415":m.highlight?`${ORANGE}20`:`#ffffff08`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{m.icon}</div>
          <div style={{flex:1}}>
            <div style={{color:m.danger?"#EF4444":m.highlight?ORANGE:"#fff",fontWeight:600,fontSize:14}}>{m.l}</div>
            <div style={{color:"#ffffff35",fontSize:12,marginTop:2}}>{m.d}</div>
          </div>
          <div style={{color:"#ffffff25",fontSize:20}}>â€¹</div>
        </div>
      ))}
    </div>
  );
}

// ==================== BUY MODAL ====================
function BuyModal({ item, user, onClose, onConfirm }) {
  const [username, setUsername] = useState("");
  const [load, setLoad]         = useState(false);
  const [succ, setSucc]         = useState(false);

  const handle = async () => {
    if (!username) return;
    setLoad(true);
    try {
      const cat = services.find(s=>s.items.some(it=>it.id===item.id))?.category || "";
      const ref = await db.collection("orders").add({
        uid: user.uid, name: user.name, email: user.email,
        service: item.name, category: cat,
        username, price: item.price,
        status: "pending",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      await sendTelegram(`ğŸ›’ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${user.name}\nâœ‰ï¸ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${user.email}\nğŸ® Ø§Ù„Ø®Ø¯Ù…Ø©: ${item.name}\nğŸ·ï¸ Ø§Ù„ÙØ¦Ø©: ${cat}\nğŸ“± Ø§Ù„Ø­Ø³Ø§Ø¨: ${username}\nğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${item.price} DH\nğŸ†” Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${ref.id.slice(0,8).toUpperCase()}\nâ° ${new Date().toLocaleString('ar-MA')}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš¡ Ù†ÙÙ‘Ø° Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†!`);
      setLoad(false); setSucc(true);
      setTimeout(onConfirm, 1500);
    } catch { setLoad(false); }
  };

  return (
    <div style={{position:"fixed",inset:0,background:"#000000CC",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:1000,backdropFilter:"blur(6px)"}} onClick={onClose}>
      <div onClick={e=>e.stopPropagation()} style={{background:CARD2,borderRadius:"26px 26px 0 0",padding:28,width:"100%",maxWidth:480,border:`1px solid #ffffff12`,borderBottom:"none",animation:"slideUp 0.35s ease"}}>
        <div style={{width:40,height:4,background:"#ffffff20",borderRadius:2,margin:"0 auto 24px"}}/>
        {succ ? (
          <div style={{textAlign:"center",padding:"30px 0"}}>
            <div style={{fontSize:60,animation:"float 1s ease"}}>âœ…</div>
            <div style={{color:"#22C55E",fontWeight:800,fontSize:20,marginTop:16}}>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!</div>
            <div style={{color:"#ffffff50",fontSize:13,marginTop:8}}>Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹</div>
          </div>
        ) : (
          <>
            <div style={{textAlign:"center",marginBottom:24}}>
              <div style={{width:60,height:60,borderRadius:16,fontSize:28,background:`${ORANGE}15`,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 12px"}}>
                {services.find(s=>s.items.some(it=>it.id===item.id))?.icon}
              </div>
              <div style={{color:"#fff",fontWeight:800,fontSize:18}}>{item.name}</div>
              <div style={{color:"#ffffff50",fontSize:13,marginTop:4}}>{item.desc}</div>
            </div>
            <div style={{background:"#ffffff06",borderRadius:14,padding:16,marginBottom:20}}>
              <div style={{display:"flex",justifyContent:"space-between"}}>
                <span style={{color:"#ffffff60"}}>Ø§Ù„Ø³Ø¹Ø±</span>
                <span style={{color:ORANGE,fontWeight:700,fontSize:18}}>{item.price} DH</span>
              </div>
            </div>
            <div style={{marginBottom:20}}>
              <div style={{color:"#ffffff60",fontSize:13,marginBottom:8}}>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… / ID Ø§Ù„Ø­Ø³Ø§Ø¨</div>
              <input value={username} onChange={e=>setUsername(e.target.value)} placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ID..."
                style={{width:"100%",background:"#ffffff08",border:`1px solid ${username?ORANGE+"40":"#ffffff15"}`,borderRadius:14,padding:"14px 16px",color:"#fff",fontSize:14,outline:"none",boxSizing:"border-box"}}/>
            </div>
            <button onClick={handle} disabled={!username||load} style={{width:"100%",background:!username?"#ffffff10":`linear-gradient(135deg,${ORANGE},${ORANGE2})`,border:"none",borderRadius:18,padding:"17px",color:!username?"#ffffff30":"#fff",fontWeight:800,fontSize:16,cursor:!username?"default":"pointer",transition:"all 0.3s"}}>
              {load ? <span style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><span style={{width:18,height:18,borderRadius:"50%",border:"2px solid #ffffff40",borderTopColor:"#fff",display:"inline-block",animation:"spin 0.8s linear infinite"}}/>Ø¬Ø§Ø±ÙŠ...</span> : "âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"}
            </button>
          </>
        )}
      </div>
    </div>
  );
}

// ==================== MAIN APP ====================
function App() {
  const [splash, setSplash]   = useState(true);
  const [user, setUser]       = useState(null);
  const [authLoading, setAL]  = useState(true);
  const [tab, setTab]         = useState("home");
  const [balance, setBalance] = useState(0);
  const [buyItem, setBuyItem] = useState(null);
  const [toast, setToast]     = useState(null);

  const showToast = msg => { setToast(msg); setTimeout(()=>setToast(null),3500); };

  useEffect(() => {
    const unsub = auth.onAuthStateChanged(async fbUser => {
      if (fbUser) {
        try {
          const snap = await db.collection("users").doc(fbUser.uid).get();
          const data = snap.exists ? snap.data() : {};
          setUser({ uid: fbUser.uid, name: data.name||fbUser.displayName||fbUser.email.split("@")[0], email: fbUser.email, balance: data.balance||0 });
          setBalance(data.balance||0);
        } catch(e) {
          // âœ… Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ FirestoreØŒ ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹
          setUser({ uid: fbUser.uid, name: fbUser.displayName||fbUser.email.split("@")[0], email: fbUser.email, balance: 0 });
          setBalance(0);
        }
      } else {
        setUser(null);
      }
      setAL(false);
    });
    return () => unsub();
  }, []);

  const handleLogin = (userData) => {
    setUser(userData);
    setBalance(userData.balance||0);
    showToast(`ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ ${userData.name}!`);
  };

  const handleLogout = async () => {
    await auth.signOut();
    setUser(null);
    setTab("home");
    showToast("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
  };

  const handleConfirmBuy = () => {
    setBuyItem(null);
    showToast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ! Ø³ÙŠØµÙ„Ùƒ Ø±Ø¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹");
    setTab("orders");
  };

  const tabs = [
    {id:"home",    icon:"ğŸ ", label:"Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"},
    {id:"services",icon:"ğŸ›’", label:"Ø§Ù„Ø®Ø¯Ù…Ø§Øª"},
    {id:"orange",  icon:"ğŸŸ ", label:"Orange"},
    {id:"orders",  icon:"ğŸ“¦", label:"Ø·Ù„Ø¨Ø§ØªÙŠ"},
    {id:"profile", icon:"ğŸ‘¤", label:"Ø­Ø³Ø§Ø¨ÙŠ"},
  ];

  if (splash) return <Splash onDone={()=>setSplash(false)}/>;

  if (authLoading) return (
    <div style={{minHeight:"100vh",background:BG,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:16}}>
      <div style={{width:50,height:50,borderRadius:"50%",border:`3px solid ${ORANGE}30`,borderTopColor:ORANGE,animation:"spin 0.8s linear infinite"}}/>
      <div style={{color:"#ffffff40",fontSize:14}}>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
    </div>
  );

  if (!user) return (
    <>
      <LoginScreen onLogin={handleLogin} showToast={showToast}/>
      {toast && <div style={{position:"fixed",top:30,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,color:"#fff",borderRadius:18,padding:"13px 26px",fontWeight:700,fontSize:14,zIndex:9999,whiteSpace:"nowrap",animation:"toastIn 0.3s ease"}}>{toast}</div>}
    </>
  );

  return (
    <div style={{background:BG,minHeight:"100vh",maxWidth:480,margin:"0 auto",position:"relative",paddingBottom:85}}>
      <div style={{background:`${BG}F0`,backdropFilter:"blur(16px)",padding:"16px 20px 12px",position:"sticky",top:0,zIndex:100,borderBottom:`1px solid #ffffff08`}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div style={{fontWeight:900,fontSize:22,letterSpacing:3,background:`linear-gradient(90deg,${ORANGE},${ORANGE2})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>âš¡ FAST STORE</div>
          <div style={{display:"flex",gap:10,alignItems:"center"}}>
            <div style={{background:`${ORANGE}15`,border:`1px solid ${ORANGE}30`,borderRadius:22,padding:"5px 14px",color:ORANGE,fontSize:13,fontWeight:700}}>
              ğŸŸ  <Counter value={balance}/> DH
            </div>
            <div style={{width:36,height:36,borderRadius:10,background:CARD,border:`1px solid #ffffff0A`,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:18}}>ğŸ””</div>
          </div>
        </div>
      </div>

      <div style={{paddingTop:16}}>
        {tab==="home"     && <HomeTab user={user} balance={balance} onBuy={setBuyItem} setTab={setTab}/>}
        {tab==="services" && <ServicesTab onBuy={setBuyItem}/>}
        {tab==="orange"   && <OrangeTab user={user} balance={balance} setBalance={setBalance}/>}
        {tab==="orders"   && <OrdersTab user={user}/>}
        {tab==="profile"  && <ProfileTab user={user} balance={balance} setTab={setTab} onLogout={handleLogout}/>}
      </div>

      <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:480,background:`${CARD2}F5`,backdropFilter:"blur(20px)",borderTop:`1px solid #ffffff0A`,padding:"10px 8px 18px",zIndex:200}}>
        <div style={{display:"flex",justifyContent:"space-around"}}>
          {tabs.map(t=>{
            const active=tab===t.id;
            return (
              <button key={t.id} onClick={()=>setTab(t.id)} style={{background:"none",border:"none",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:4,padding:"0 6px"}}>
                <div style={{width:44,height:44,borderRadius:13,background:active?`${ORANGE}20`:"transparent",border:active?`1px solid ${ORANGE}40`:"1px solid transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,transition:"all 0.25s",boxShadow:active?`0 0 15px ${ORANGE}30`:"none",transform:active?"scale(1.1)":"scale(1)"}}>
                  {t.icon}
                </div>
                <div style={{fontSize:10,fontWeight:active?700:400,color:active?ORANGE:"#ffffff35",transition:"all 0.25s"}}>{t.label}</div>
              </button>
            );
          })}
        </div>
      </div>

      {buyItem && <BuyModal item={buyItem} user={user} onClose={()=>setBuyItem(null)} onConfirm={handleConfirmBuy}/>}

      {toast && (
        <div style={{position:"fixed",top:80,left:"50%",transform:"translateX(-50%)",background:`linear-gradient(135deg,${ORANGE},${ORANGE2})`,color:"#fff",borderRadius:18,padding:"13px 26px",fontWeight:700,fontSize:14,zIndex:999,whiteSpace:"nowrap",boxShadow:`0 8px 30px ${ORANGE}40`,animation:"toastIn 0.3s ease"}}>
          {toast}
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
